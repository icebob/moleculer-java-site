<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>About API Gateway | Moleculer</title>
    <meta name="description" content="Progressive microservices framework for Java">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/site/assets/css/0.styles.f35a1954.css" as="style"><link rel="preload" href="/site/assets/js/app.6458ec54.js" as="script"><link rel="preload" href="/site/assets/js/2.b39afa1e.js" as="script"><link rel="preload" href="/site/assets/js/21.f5bda656.js" as="script"><link rel="prefetch" href="/site/assets/js/10.952c5bc0.js"><link rel="prefetch" href="/site/assets/js/11.b25a3c1b.js"><link rel="prefetch" href="/site/assets/js/12.b93967c0.js"><link rel="prefetch" href="/site/assets/js/13.4b759897.js"><link rel="prefetch" href="/site/assets/js/14.ef10bd2d.js"><link rel="prefetch" href="/site/assets/js/15.a94fd884.js"><link rel="prefetch" href="/site/assets/js/16.b54b5939.js"><link rel="prefetch" href="/site/assets/js/17.63f39932.js"><link rel="prefetch" href="/site/assets/js/18.1e00cf92.js"><link rel="prefetch" href="/site/assets/js/19.33d4cc20.js"><link rel="prefetch" href="/site/assets/js/20.aca4251c.js"><link rel="prefetch" href="/site/assets/js/22.baf3db37.js"><link rel="prefetch" href="/site/assets/js/23.5746f400.js"><link rel="prefetch" href="/site/assets/js/24.dcfe8fa4.js"><link rel="prefetch" href="/site/assets/js/25.6c8e5111.js"><link rel="prefetch" href="/site/assets/js/26.dcebd387.js"><link rel="prefetch" href="/site/assets/js/27.f09918ca.js"><link rel="prefetch" href="/site/assets/js/28.f634c817.js"><link rel="prefetch" href="/site/assets/js/29.2d4217a8.js"><link rel="prefetch" href="/site/assets/js/3.b78c1751.js"><link rel="prefetch" href="/site/assets/js/4.3e9b503d.js"><link rel="prefetch" href="/site/assets/js/5.51cf4fa4.js"><link rel="prefetch" href="/site/assets/js/6.6365da8d.js"><link rel="prefetch" href="/site/assets/js/7.2ec3348e.js"><link rel="prefetch" href="/site/assets/js/8.b9158c43.js"><link rel="prefetch" href="/site/assets/js/9.26725b2a.js">
    <link rel="stylesheet" href="/site/assets/css/0.styles.f35a1954.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/site/" class="home-link router-link-active"><img src="logo.png" alt="Moleculer" class="logo"> <span class="site-name can-hide">Moleculer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div><div class="nav-item"><a href="https://www.patreon.com/moleculer_java" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Donate
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div><div class="nav-item"><a href="https://www.patreon.com/moleculer_java" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Donate
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Moleculer core</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Clustering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/site/moleculer-web.html" class="active sidebar-link">Web API Gateway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#about-api-gateway" class="sidebar-link">About API Gateway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#features" class="sidebar-link">Features</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#download" class="sidebar-link">Download</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#short-example" class="sidebar-link">Short Example</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#detailed-example" class="sidebar-link">Detailed Example</a></li></ul></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#routes" class="sidebar-link">Routes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#mapping-policy" class="sidebar-link">Mapping policy</a></li></ul></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#whitelist" class="sidebar-link">Whitelist</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#aliases" class="sidebar-link">Aliases</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#http-middlewares" class="sidebar-link">HTTP Middlewares</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#multiple-routes" class="sidebar-link">Multiple Routes</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#route-hooks" class="sidebar-link">Route hooks</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#response-type-status-code" class="sidebar-link">Response type &amp; status code</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#built-in-middlewares" class="sidebar-link">Built-in Middlewares</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#servestatic-middleware" class="sidebar-link">ServeStatic Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#redirector-middleware" class="sidebar-link">Redirector Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#notfound-middleware" class="sidebar-link">NotFound Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#favicon-middleware" class="sidebar-link">Favicon Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#basicauthenticator-middleware" class="sidebar-link">BasicAuthenticator Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#corsheaders-middleware" class="sidebar-link">CorsHeaders Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#errorpage-middleware" class="sidebar-link">ErrorPage Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#hostnamefilter-middleware" class="sidebar-link">HostNameFilter Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#ipfilter-middleware" class="sidebar-link">IpFilter Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#ratelimiter-middleware" class="sidebar-link">RateLimiter Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#requestlogger-middleware" class="sidebar-link">RequestLogger Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#responsedeflater-middleware" class="sidebar-link">ResponseDeflater Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#responseheaders-middleware" class="sidebar-link">ResponseHeaders Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#responsetime-middleware" class="sidebar-link">ResponseTime Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#responsetimeout-middleware" class="sidebar-link">ResponseTimeout Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#sessioncookie-middleware" class="sidebar-link">SessionCookie Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#toplevelcache-middleware" class="sidebar-link">TopLevelCache Middleware</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#xsrftoken-middleware" class="sidebar-link">XSRFToken Middleware</a></li></ul></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#template-engines" class="sidebar-link">Template Engines</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#mustache-template-engine" class="sidebar-link">Mustache Template Engine</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#handlebars-template-engine" class="sidebar-link">Handlebars Template Engine</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#datatree-template-engine" class="sidebar-link">DataTree Template Engine</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#freemarker-template-engine" class="sidebar-link">FreeMarker Template Engine</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#jade-template-engine" class="sidebar-link">Jade Template Engine</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#pebble-template-engine" class="sidebar-link">Pebble Template Engine</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#thymeleaf-template-engine" class="sidebar-link">Thymeleaf Template Engine</a></li></ul></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#internationalization-i18n" class="sidebar-link">Internationalization (i18n)</a></li><li class="sidebar-sub-header"><a href="/site/moleculer-web.html#websocket-handling" class="sidebar-link">WebSocket handling</a></li></ul></li><li><a href="/site/moleculer-repl.html" class="sidebar-link">Moleculer REPL</a></li><li><a href="/site/mongo-client.html" class="sidebar-link">MongoDB client</a></li><li><a href="/site/http-client.html" class="sidebar-link">HTTP client</a></li><li><a href="/site/jmx-service.html" class="sidebar-link">JMX Service</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="about-api-gateway"><a href="#about-api-gateway" class="header-anchor">#</a> About API Gateway</h2> <p>Moleculer API Gateway is a <code>Service</code> that makes other Moleculer <code>Services</code> available through REST.
It allows to create high-performance, non-blocking, distributed web applications.
Web request processing can be fine tuned using server-independent middlewares.
Moleculer API Gateway provides full support for high-load <strong>React</strong>, <strong>Angular</strong> or <strong>VueJS</strong> applications.</p> <h3 id="features"><a href="#features" class="header-anchor">#</a> Features</h3> <ul><li>Same code can run as a J2EE Servlet or as a high-performance Netty application without changing a single program line</li> <li>WebSocket support (same API for Netty Server and J2EE Servers)</li> <li>Supports server-side template engines (FreeMarker, Jade, Pebble, Thymeleaf, Mustache, Velocity)</li> <li>Many built-in middlewares (ServeStatic, CORS headers, custom error messages, etc.)</li></ul> <p><strong>The Moleculer API Gateway is compatible with the following Servlet Containers / J2EE Servers:</strong></p> <ul><li>Oracle WebLogic Server V12</li> <li>Red Hat JBoss Enterprise Application Platform V7</li> <li>WebSphere Application Server V19 Liberty</li> <li>GlassFish Server Open Source Edition V4 and V5</li> <li>Apache Tomcat V7, V8 and V9</li> <li>Eclipse Jetty V9</li> <li>Payara Server V5</li></ul> <p>API Gateway may work with other servers (it's built on the standard Servlet v3.1 API,
but it also includes a fallback implementation for older servers).</p> <div align="center"><img src="web-runtimes.svg" alt="Runtimes" class="zoom"></div> <p>It is also possible to implement a design where only the <em>API Gateway</em> and <em>NettyServer</em> services are present in the Moleculer nodes.
Within Moleculer nodes, HTTP requests can be distributed through a <em>HTTP Load Balancer</em>.
These Moleculer nodes perform static HTTP servicing and, if necessary, HTML transforms.
REST requests are transmitted through a Message Broker (or directly via TCP Transporter) to multiple nodes running in the background.
The number of servers (Moleculer nodes) can vary depending on the load.</p> <div align="center"><img src="web-cluster.svg" alt="Clustered runtime" class="zoom"></div> <h3 id="download"><a href="#download" class="header-anchor">#</a> Download</h3> <p><strong>Maven</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.berkesa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>moleculer-java-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Gradle</strong></p> <div class="language-gradle extra-class"><pre class="language-text"><code>dependencies {
    implementation group: 'com.github.berkesa', name: 'moleculer-java-web', version: '1.2.8' 
}
</code></pre></div><h3 id="short-example"><a href="#short-example" class="header-anchor">#</a> Short Example</h3> <p>The simplest way to create a REST service using Moleculer is the following:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApiGateway</span><span class="token punctuation">(</span><span class="token string">&quot;**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Service</span><span class="token punctuation">(</span><span class="token string">&quot;math&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">Action</span> add <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>After starting the program, enter the following URL into your browser:<br> <code>http://localhost:3000/math/add?a=3&amp;b=6</code></p> <p>The response will be &quot;9&quot;. The above service can also be invoked using a POST method.<br>
To do this, submit the {&quot;a&quot;:3,&quot;b&quot;:5} JSON (as POST body) to this URL:<br> <code>http://localhost:300/math/add</code></p> <p>You can access all services, including <a href="/site/internal-services.html">internal &quot;$node&quot; Service</a>.</p> <p><strong>Example URLs</strong></p> <ul><li>Call test.hello action: <code>http://localhost:3000/test/hello</code></li> <li>Get health info of node:  <code>http://localhost:3000/~node/health</code></li> <li>List of nodes in cluster: <code>http://localhost:3000/~node/list</code></li> <li>List of Event listeners:  <code>http://localhost:3000/~node/events</code></li> <li>List of Services: <code>http://localhost:3000/~node/services</code></li> <li>List of Actions:  <code>http://localhost:3000/~node/actions</code></li></ul> <h3 id="detailed-example"><a href="#detailed-example" class="header-anchor">#</a> Detailed Example</h3> <p><a href="https://moleculer-java.github.io/moleculer-spring-boot-demo/" target="_blank" rel="noopener noreferrer">This demo project<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
demonstrating some of the capabilities of APIGateway.<br>
The project can be imported into the Eclipse IDE or IntelliJ IDEA.
The brief examples illustrate the following:</p> <ul><li>Integration of Moleculer API into the Spring Boot Framework</li> <li>Configuring HTTP <code>Routes</code> and <code>Middlewares</code></li> <li>Creating non-blocking Moleculer <code>Services</code></li> <li>Publishing and invoking Moleculer <code>Services</code> as REST <code>Services</code></li> <li>Generating HTML pages in multiple languages using Template Engines</li> <li>Using WebSockets (sending real-time server-side events to browsers)</li> <li>Using file upload and download</li> <li>Video streaming and server-side image generation</li> <li>Creating a WAR from the finished project (Servlet-based runtime)</li> <li>Run code without any changes in &quot;standalone mode&quot; (Netty-based runtime)</li></ul> <h2 id="routes"><a href="#routes" class="header-anchor">#</a> Routes</h2> <p>Like <a href="https://expressjs.com/en/guide/routing.html" target="_blank" rel="noopener noreferrer">Express.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
Moleculer Moleculer groups request processors (<a href="/site/moleculer-web.html#http-middlewares">Middlewares</a>) into different <code>Routes</code>.
Each <code>Route</code> can have one or more <code>Middlewares</code>, which are executed when the <code>Route</code> is matched.
<code>Routes</code> are matched <strong>in the order they are added to the API Gateway</strong>.
When a request arrives the API Gateway will step through each <code>Route</code>,
and examines whether the <code>Route</code> handles the request.
If the <code>Route</code> handles the request, the API Gateway does not call the next <code>Route</code>.
The following code is an example of a basic <code>Route</code>:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Create then add a Route to API Gateway</span>
<span class="token class-name">Route</span> route <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gateway<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...or in short:</span>
<span class="token class-name">Route</span> route <span class="token operator">=</span> gateway<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mapping-policy"><a href="#mapping-policy" class="header-anchor">#</a> Mapping policy</h3> <p><code>Routes</code> have a &quot;mappingPolicy&quot; property to handle <code>Routes</code> without Aliases.</p> <p><strong>Available options</strong></p> <ul><li>RESTRICT - enable to request only the <code>Routes</code> with Aliases (default)</li> <li>ALL - enable to request all <code>Routes</code> with or without Aliases</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Route</span> route <span class="token operator">=</span> gateway<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Route</span><span class="token punctuation">(</span><span class="token class-name">MappingPolicy</span><span class="token punctuation">.</span>RESTRICT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;math.add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this case, <code>Action</code> can only be called on the &quot;/add&quot; path using the &quot;POST&quot; method.
This <code>Action</code> is not available with another URL or method.</p> <h2 id="whitelist"><a href="#whitelist" class="header-anchor">#</a> Whitelist</h2> <p>If you don't want to publish all <code>Actions</code>, you can filter them with whitelist option.
Use match strings or regexp in list. <em>To enable all actions, use &quot;**&quot;.</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ApiGateway</span> gateway <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApiGateway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Route</span> route <span class="token operator">=</span> gateway<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Route</span><span class="token punctuation">(</span><span class="token string">&quot;/api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Access any actions in &quot;posts&quot; Service, eg:
 * http://localhost:3000/api/posts/action
 */</span>
route<span class="token punctuation">.</span><span class="token function">addToWhiteList</span><span class="token punctuation">(</span><span class="token string">&quot;posts/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Allow access to &quot;users/list&quot; Action, eg:
 * http://localhost:3000/api/users/list
 */</span>
route<span class="token punctuation">.</span><span class="token function">addToWhiteList</span><span class="token punctuation">(</span><span class="token string">&quot;users/list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Access any actions in &quot;math&quot; service using regex, eg:
 * http://localhost:3000/api/math/add?a=1&amp;b2
 */</span>
route<span class="token punctuation">.</span><span class="token function">addToWhiteList</span><span class="token punctuation">(</span><span class="token string">&quot;^/math/\\S+$&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//  Install Netty web server and ApiGateway  </span>
broker<span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
broker<span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span>gateway<span class="token punctuation">)</span>
broker<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="aliases"><a href="#aliases" class="header-anchor">#</a> Aliases</h2> <p>You can use Alias names instead of <code>Action</code> names.
You can also specify the method. Otherwise it will handle every method types.
Using named parameters in aliases is possible.
Named parameters are defined by prefixing a colon to the parameter name (&quot;:name&quot;).</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ApiGateway</span> gateway <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApiGateway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Route</span> route <span class="token operator">=</span> gateway<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Call &quot;auth.login&quot; action with &quot;GET /login&quot; or &quot;POST /login&quot;</span>
route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;auth.login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Restrict the request method</span>
route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users.create&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The &quot;name&quot; comes from the URL, eg:</span>
<span class="token comment">// http://localhost:3000/greeter/Jessica</span>
route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;greeter/:name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test.greeter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cover &quot;view.render&quot; Action with a &quot;virtual&quot; HTML page:</span>
<span class="token comment">// http://localhost:3000/pages/table.html</span>
route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/table.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;view.render&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//  Install Netty web server and ApiGateway  </span>
broker<span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NettyServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span>gateway<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also create RESTful APIs:</p> <div class="language-java extra-class"><pre class="language-java"><code>route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users.list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users/:id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users.get&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users.create&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;PUT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users/:id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users.update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users/:id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users.remove&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For REST routes you can also use this simple shorthand alias:</p> <div class="language-java extra-class"><pre class="language-java"><code>route<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;REST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>To use this shorthand alias, create a <code>Service</code> which has &quot;list&quot;, &quot;get&quot;, &quot;create&quot;, &quot;update&quot; and &quot;remove&quot; actions.</p></div> <h2 id="http-middlewares"><a href="#http-middlewares" class="header-anchor">#</a> HTTP Middlewares</h2> <p>HTTP <code>Middleware</code> is used to intercept the client request and do some pre-processing.
It can also intercept the response and do post-processing before sending to the client in web application.
Some common tasks that we can do with HTTP <code>Middlewares</code> are:</p> <ul><li>Formatting of request body or header before sending it to <code>Action</code>.</li> <li>Authentication and autherization of request for resources.</li> <li>Logging request parameters.</li> <li>Alter response by adding some cookies or header information.</li> <li>End the request-response cycle.</li></ul> <p>You can extend the <code>HttpMiddleware</code> abstract class to create an HTTP <code>Middleware</code>.
HTTP <code>Middlewares</code> can be added globally or at Route-level to the <code>ApiGateway</code>.
Bind <code>Middleware</code> to an instance of the API Gateway object by using the &quot;gateway.use(middleware)&quot; function.
Route-level <code>Middleware</code> works in the same way as global <code>Middleware</code>,
except it is bound to an instance of <code>Route</code>.</p> <p><code>Middlewares</code> is executed in <strong>reverse order</strong> as they are added to <code>Routes</code> (or to the <code>ApiGateway</code>):</p> <div class="language-java extra-class"><pre class="language-java"><code>route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LastMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Executed LAST</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThirdMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecondMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FirstMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Executed FIRST</span>
</code></pre></div><div align="center"><img src="middlewares.svg" alt="Calling flow" class="zoom"></div> <p>Moleculer's HTTP <code>Middlewares</code> use very similar logic to
<a href="https://expressjs.com/en/guide/using-middleware.html" target="_blank" rel="noopener noreferrer">Middlewares of Express.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
The following example implements an &quot;empty&quot; <code>Middleware</code> that passes the request without modification:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMiddleware</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMiddleware</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">RequestProcessor</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token class-name">RequestProcessor</span> next<span class="token punctuation">,</span> <span class="token class-name">Tree</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// Create new &quot;RequestProcessor&quot; or return &quot;null&quot;, this is</span>
        <span class="token comment">// decided by the &quot;config&quot; which contains the Action parameters.</span>
        <span class="token comment">// If you return &quot;null&quot;, you won't install Middleware for the Action.</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AbstractRequestProcessor</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">WebRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">WebResponse</span> rsp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

                <span class="token comment">// --- FUNCTIONS BEFORE CALLING THE ACTION ---</span>

                <span class="token comment">// Do nothig, just invoke next Middleware or Action</span>
                next<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> rsp<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// --- FUNCTIONS AFTER CALLING THE ACTION ---</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The chain of the <code>Route</code> can be terminated if you do not call &quot;next.service&quot; but fill in &quot;rsp&quot; with the answer
(for example, sending a regular &quot;403 Forbidden&quot; HTTP error message). The
<a href="https://github.com/moleculer-java/moleculer-java-web/tree/master/src/main/java/services/moleculer/web/middleware" target="_blank" rel="noopener noreferrer">GitHub page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
of the API Gateway project has many examples of HTTP <code>Middlewares</code>.</p> <p>There is another kind of middleware in the Moleculer Framework; the <code>Middleware</code>.
The <code>Middleware</code> is similar to <code>HttpMiddleware</code>, but it processes internal <code>Action</code> calls instead of HTTP requests.<br> <a href="/site/middlewares.html#about-middlewares">Read more about Middlewares</a></p> <h2 id="multiple-routes"><a href="#multiple-routes" class="header-anchor">#</a> Multiple Routes</h2> <p>Complex web applications require multiple <code>Routes</code>.
Usually one Route is required for REST services and one for static content
(HTML pages, CSS files, images, etc.).
The policy for REST <code>Route</code> &quot;RESTRICT&quot; (this is the default policy)
because only the REST services that are configured can be called.
The policy for static <code>Route</code> is &quot;ALL&quot; because it accepts all requests
and returns a &quot;404 Not Found&quot; message if the requested file is not exists:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Create Route for REST services:</span>
<span class="token class-name">Route</span> restRoute <span class="token operator">=</span> gateway<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
restRoute<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CorsHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
restRoute<span class="token punctuation">.</span><span class="token function">setCallOptions</span><span class="token punctuation">(</span><span class="token class-name">CallOptions</span><span class="token punctuation">.</span><span class="token function">retryCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
restRoute<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Allowed HTTP method</span>
                   <span class="token string">&quot;api/hello/:name&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Path alias</span>
                   <span class="token string">&quot;greeter.hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Action</span>

<span class="token comment">// Create Route for static files:</span>
<span class="token class-name">Route</span> staticRoute <span class="token operator">=</span> gateway<span class="token punctuation">.</span><span class="token function">addRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
staticRoute<span class="token punctuation">.</span><span class="token function">setMappingPolicy</span><span class="token punctuation">(</span><span class="token class-name">MappingPolicy</span><span class="token punctuation">.</span>ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>
staticRoute<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
staticRoute<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServeStatic</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
staticRoute<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Favicon</span><span class="token punctuation">(</span><span class="token string">&quot;/www/img/favicon.ico&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
staticRoute<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Redirector</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span> <span class="token number">307</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div align="center"><img src="web-routes.svg" alt="Web routes" class="zoom"></div> <h2 id="route-hooks"><a href="#route-hooks" class="header-anchor">#</a> Route hooks</h2> <p>API Gateway has before &amp; after call hooks.
The &quot;setBeforeCall&quot; and &quot;setAfterCall&quot; functions provide
low-level access to the HTTP request or response:</p> <div class="language-java extra-class"><pre class="language-java"><code>gateway<span class="token punctuation">.</span><span class="token function">setBeforeCall</span><span class="token punctuation">(</span><span class="token punctuation">(</span>currentRoute<span class="token punctuation">,</span> req<span class="token punctuation">,</span> rsp<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;/api/upload&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// Copy remote address into the &quot;meta&quot; block,</span>
        <span class="token comment">// so this value will be visible to the Action</span>
        <span class="token class-name">Tree</span> meta <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">getMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        meta<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
</code></pre></div><p>The &quot;getInternalObject&quot; function can be used to access the actual <code>HttpServletRequest</code>,
<code>HttpServletResponse</code> or Netty's <code>ChannelHandlerContext</code> object:</p> <div class="language-java extra-class"><pre class="language-java"><code>gateway<span class="token punctuation">.</span><span class="token function">setBeforeCall</span><span class="token punctuation">(</span><span class="token punctuation">(</span>currentRoute<span class="token punctuation">,</span> req<span class="token punctuation">,</span> rsp<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> internal <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getInternalObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>internal <span class="token keyword">instanceof</span> <span class="token class-name">ChannelHandlerContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// Moleculer is running under Netty</span>
        <span class="token class-name">ChannelHandlerContext</span> nettyRequest <span class="token operator">=</span>
                        <span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span><span class="token punctuation">)</span> internal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

        <span class="token comment">// Moleculer is running under J2EE Server</span>
        <span class="token class-name">HttpServletRequest</span> servletRequest <span class="token operator">=</span>
                        <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> internal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="response-type-status-code"><a href="#response-type-status-code" class="header-anchor">#</a> Response type &amp; status code</h2> <p>When the response is received from an <code>Action</code>,
the API Gateway checks the &quot;meta&quot; block to see if it contains certain special fields.
With these meta fields, you can change the &quot;Content-Type&quot; header,
the status code of the response and add any HTTP header to the response.</p> <p><strong>Special meta fields</strong></p> <ul><li>ctx.meta.$statusCode - Status code (eg. 200, 404) of the HTTP response message</li> <li>ctx.meta.$responseType - Content-Type header's value of the HTTP response message</li> <li>ctx.meta.$responseHeaders - Set of response headers (it's a Map, not a single value)</li> <li>ctx.meta.$location - Location in header for redirects (relative URL)</li> <li>ctx.meta.$template - Name of the HTML template (eg. &quot;test&quot; means &quot;test.html&quot;)</li> <li>ctx.meta.$locale - Locale (~= language) of the generated HTML page (eg. &quot;de&quot;, &quot;fr&quot;, &quot;en_uk&quot;)</li> <li>ctx.meta.$session - Variables of the current <a href="/site/moleculer-web.html#sessioncookie-middleware">HTTP-session</a></li></ul> <p><strong>Example: Invoke Template Engine</strong></p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">Action</span> list <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Create response &quot;JSON&quot;</span>
    <span class="token class-name">Tree</span> rsp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rsp<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">// Get the hidden meta block of the response</span>
    <span class="token class-name">Tree</span> meta <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">getMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set status code and Content-Type</span>
    meta<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;$statusCode&quot;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;$responseType&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Add extra HTTP headers</span>
    <span class="token class-name">Tree</span> headers <span class="token operator">=</span> meta<span class="token punctuation">.</span><span class="token function">putMap</span><span class="token punctuation">(</span><span class="token string">&quot;$responseHeaders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;X-Header-Name1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Header-Value1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;X-Header-Name2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Header-Value2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;X-Header-Name3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Header-Value3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Convert response by using</span>
    <span class="token comment">// server-side Template Engine</span>
    meta<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;$template&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// test.html</span>
    meta<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;$locale&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;en_us&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Locale (optional)</span>
    
    <span class="token comment">// Return response</span>
    <span class="token keyword">return</span> rsp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Example: Send image file to browser</strong></p> <p>The &quot;Content-Type&quot; value, status code and other HTTP headers
can be changed even if the answer is a <strong>Moleculer Stream</strong>.
Since <code>PacketStream</code> has no &quot;meta&quot;, it needs to be wrapped in a
<a href="https://berkesa.github.io/datatree/" target="_blank" rel="noopener noreferrer">Tree<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> object:</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">Action</span> list <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Open Stream</span>
    <span class="token class-name">PacketStream</span> stream <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// Trasfer data from file</span>
    stream<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;/image.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// Stream is wrapped in a Tree object,</span>
    <span class="token comment">// it's just for the meta (Stream has no meta)</span>
    <span class="token class-name">Tree</span> rsp <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">CheckedTree</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get the meta block</span>
    <span class="token class-name">Tree</span> meta <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">getMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set the Content-Type of the response</span>
    meta<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;$responseType&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Return response (and the Stream in it)</span>
    <span class="token keyword">return</span> rsp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Example: Dynamic content generation</strong></p> <p>The following <code>Action</code> will be available at:
http://localhost:3000/dynamic.txt<br>
This was set by the &quot;@HttpAlias&quot; Annotation.
The same could be done by adding a similar Alias to <code>Route</code>.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@HttpAlias</span><span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">&quot;/dynamic.txt&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">Action</span> img <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Response text</span>
    <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">&quot;Server time: &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Send text as PacketStream</span>
    <span class="token class-name">PacketStream</span> stream <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">sendData</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">sendClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set HTML headers of the response</span>
    <span class="token class-name">Tree</span> rsp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheckedTree</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Tree</span> headers <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">getMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putMap</span><span class="token punctuation">(</span><span class="token string">&quot;$responseHeaders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Length&quot;</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Same as &quot;$responseType&quot; just set it here as header</span>
    headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/plain; charset=utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> rsp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Typing the URL &quot;.../dynamic.txt&quot; into your browser
will display content similar to the following:<br> <code>Server time: Tue Jan 21 16:09:22 CET 2020</code></p> <h2 id="built-in-middlewares"><a href="#built-in-middlewares" class="header-anchor">#</a> Built-in Middlewares</h2> <p>Moleculer API Gateway contains many pre-built HTTP <code>Middlewares</code>.
These Middleware's can be integrated into web applications to speed up application development.</p> <h3 id="servestatic-middleware"><a href="#servestatic-middleware" class="header-anchor">#</a> ServeStatic Middleware</h3> <p><code>Middleware</code> to serve files from a specified root directory. If the file is not
found, it sends a 404 response. <code>ServeStatic</code> supports content compression,
automatic &quot;Content-Type&quot; detection, and ETAGs.
The specified directory (the &quot;/www&quot; in the example below)
can be in the file system or on the classpath.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/ServeStatic.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Simple usage</span>
<span class="token class-name">ServeStatic</span> staticHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServeStatic</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
staticHandler<span class="token punctuation">.</span><span class="token function">setEnableReloading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// Turn off in production mode</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>staticHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Middlewares of a typical web server (in the correct order)</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// To be executed last (404 Not Found)</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServeStatic</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Static files (html, css, etc.)</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Favicon</span><span class="token punctuation">(</span><span class="token string">&quot;/www/img/favicon.ico&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Favicon (file or classpath)</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Redirector</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span> <span class="token number">307</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Jump to default page</span>
</code></pre></div><h3 id="redirector-middleware"><a href="#redirector-middleware" class="header-anchor">#</a> Redirector Middleware</h3> <p>Redirects requests from a specified location to an another location.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/Redirector.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Any requests to the root path &quot;/&quot;</span>
<span class="token comment">// will cause the &quot;index.html&quot; page to be served.</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Redirector</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span> <span class="token number">307</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Jump from multiple path to default page</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Redirector</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Redirector</span><span class="token punctuation">(</span><span class="token string">&quot;/index.htm&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Redirector</span><span class="token punctuation">(</span><span class="token string">&quot;/default.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="notfound-middleware"><a href="#notfound-middleware" class="header-anchor">#</a> NotFound Middleware</h3> <p>Refuses all HTTP requests with &quot;Error 400 Not Found&quot; message.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/NotFound.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Usage with &quot;ServeStatic&quot; and &quot;Favicon&quot; middlewares:</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Executed last</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServeStatic</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Executed second</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Favicon</span><span class="token punctuation">(</span><span class="token string">&quot;/www/images/custom.ico&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Executed first</span>
</code></pre></div><h3 id="favicon-middleware"><a href="#favicon-middleware" class="header-anchor">#</a> Favicon Middleware</h3> <p>Handles &quot;/favicon.ico&quot; HTTP requests.
Favicons can be specified using a path to the filesystem,
or by default this <code>Middleware</code> will look for a file on the classpath with the name &quot;favicon.ico&quot;.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/Favicon.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code>route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Favicon</span><span class="token punctuation">(</span><span class="token string">&quot;custom.ico&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="basicauthenticator-middleware"><a href="#basicauthenticator-middleware" class="header-anchor">#</a> BasicAuthenticator Middleware</h3> <p>Simple middleware that provides HTTP BASIC Authentication support.
When the BasicAuthenticator <code>Middleware</code> receives this information,
it calls the configured <code>BasicAuthProvider</code> with the username and password to authenticate the user.
If the authentication is successful the handler attempts to authorise the user.
If that is successful then the routing of the request is allowed to continue to the application handlers,
otherwise a 403 response is returned to signify that access is denied.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/BasicAuthenticator.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Allow only one user</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BasicAuthenticator</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Allow multiple users</span>
<span class="token class-name">BasicAuthenticator</span>    authenticator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicAuthenticator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authenticator<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token string">&quot;user1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authenticator<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token string">&quot;user2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use custom authenticator</span>
<span class="token class-name">BasicAuthenticator</span>    authenticator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicAuthenticator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authenticator<span class="token punctuation">.</span><span class="token function">setProvider</span><span class="token punctuation">(</span><span class="token punctuation">(</span>broker<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Allow usernames starting with &quot;xyz&quot;</span>
    <span class="token keyword">return</span> username<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;xyz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="corsheaders-middleware"><a href="#corsheaders-middleware" class="header-anchor">#</a> CorsHeaders Middleware</h3> <p>Implements server side <a href="https://www.w3.org/wiki/CORS" target="_blank" rel="noopener noreferrer">CORS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> support for Moleculer.
Cross Origin Resource Sharing is a mechanism for allowing resources to be requested from one host and served from another.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/CorsHeaders.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Allow all</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CorsHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// With custom CORS parameters</span>
<span class="token class-name">CorsHeaders</span> cors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorsHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cors<span class="token punctuation">.</span><span class="token function">setOrigin</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cors<span class="token punctuation">.</span><span class="token function">setMethods</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cors<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>cors<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="errorpage-middleware"><a href="#errorpage-middleware" class="header-anchor">#</a> ErrorPage Middleware</h3> <p>Custom error page (Error 404, 500, etc.) handler.
Error templates can contain the following variables:
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/ErrorPage.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <table><thead><tr><th>Variable</th> <th>Content</th></tr></thead> <tbody><tr><td>{status}</td> <td>HTTP status code</td></tr> <tr><td>{message}</td> <td>Error message</td></tr> <tr><td>{stack}</td> <td>Stack trace</td></tr></tbody></table> <p><strong>Sample error template</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>{message}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{status}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>{stack}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Defining status-specific error templates</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Default error template</span>
<span class="token class-name">ErrorPage</span> errorPages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span><span class="token string">&quot;error-default.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Status-specific templates</span>
errorPages<span class="token punctuation">.</span><span class="token function">setTemplate</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">&quot;error-404.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
errorPages<span class="token punctuation">.</span><span class="token function">setTemplate</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">&quot;error-500.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>errorPages<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hostnamefilter-middleware"><a href="#hostnamefilter-middleware" class="header-anchor">#</a> HostNameFilter Middleware</h3> <p>The <code>HostNameFilter</code> adds the ability to allow or block requests based on the host name of the client.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/HostNameFilter.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">HostNameFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HostNameFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
filter<span class="token punctuation">.</span><span class="token function">allow</span><span class="token punctuation">(</span><span class="token string">&quot;domain.server**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Allow all with this prefix</span>
filter<span class="token punctuation">.</span><span class="token function">deny</span><span class="token punctuation">(</span><span class="token string">&quot;domain.server22&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Except this</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ipfilter-middleware"><a href="#ipfilter-middleware" class="header-anchor">#</a> IpFilter Middleware</h3> <p>The <code>IpFilter</code> <code>Middleware</code> adds the ability to allow or block requests based on the IP address of the client.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/IpFilter.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IpFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IpFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
filter<span class="token punctuation">.</span><span class="token function">allow</span><span class="token punctuation">(</span><span class="token string">&quot;150.10.**&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;255.12.34.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Let's enable them</span>
filter<span class="token punctuation">.</span><span class="token function">deny</span><span class="token punctuation">(</span><span class="token string">&quot;150.10.0.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Except this</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ratelimiter-middleware"><a href="#ratelimiter-middleware" class="header-anchor">#</a> RateLimiter Middleware</h3> <p>Rate Limiter limits concurrent constant requests to the HTTP calls in the application.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/RateLimiter.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Allow up to 50 requests / second (default)</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Allow up to 100 requests / 2 minutes</span>
<span class="token class-name">RateLimiter</span> limiter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
limiter<span class="token punctuation">.</span><span class="token function">setRateLimit</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
limiter<span class="token punctuation">.</span><span class="token function">setWindow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
limiter<span class="token punctuation">.</span><span class="token function">setUnit</span><span class="token punctuation">(</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>limiter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Annotation-driven rate limiting</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Restrict to annotated Actions only</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...and in the Service</span>
<span class="token annotation punctuation">@RateLimit</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> window <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> unit <span class="token operator">=</span> <span class="token string">&quot;MINUTES&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">Action</span> render <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="requestlogger-middleware"><a href="#requestlogger-middleware" class="header-anchor">#</a> RequestLogger Middleware</h3> <p>Writes request headers and response headers + response body into the log.
Request body not logged in this version. WARNING: Using this middleware
reduces the performance (nevertheless, it may be useful during development).
Be sure to turn it off in production mode.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/RequestLogger.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code>route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="responsedeflater-middleware"><a href="#responsedeflater-middleware" class="header-anchor">#</a> ResponseDeflater Middleware</h3> <p>Compresses body of REST responses. Do not use it with <code>ServeStatic</code> <code>Middleware</code>;
<code>ServeStatic</code> also compresses the data. Use it to compress the response of REST
services.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/ResponseDeflater.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code>route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResponseDeflater</span><span class="token punctuation">(</span><span class="token class-name">Deflater</span><span class="token punctuation">.</span>BEST_SPEED<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Using compression reduces performance, so use it only on slow networks.</p></div> <h3 id="responseheaders-middleware"><a href="#responseheaders-middleware" class="header-anchor">#</a> ResponseHeaders Middleware</h3> <p>This <code>Middleware</code> unconditionally adds the specified headers to any HTTP response within the Route.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/ResponseHeaders.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Add single header to HTTP responses</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResponseHeaders</span><span class="token punctuation">(</span><span class="token string">&quot;X-Robots-Tag&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;noindex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add multiple headers to HTTP responses</span>
<span class="token class-name">ResponseHeaders</span> securityHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResponseHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
securityHeaders<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-Download-Options&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;noopen&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
securityHeaders<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-Content-Type-Options&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nosniff&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
securityHeaders<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-XSS-Protection&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1; mode=block&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
securityHeaders<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;X-FRAME-OPTIONS&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DENY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
securityHeaders<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Strict-Transport-Security&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;max-age=12345000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>securityHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="responsetime-middleware"><a href="#responsetime-middleware" class="header-anchor">#</a> ResponseTime Middleware</h3> <p>Adds &quot;X-Response-Time&quot; header to the response,
containing the time taken in MILLISECONDS to process the request.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/ResponseTime.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// With &quot;X-Response-Time&quot; header</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResponseTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// With custom header name</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResponseTime</span><span class="token punctuation">(</span><span class="token string">&quot;X-Custom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="responsetimeout-middleware"><a href="#responsetimeout-middleware" class="header-anchor">#</a> ResponseTimeout Middleware</h3> <p><code>Middleware</code> that will timeout requests if the response has not been written
after the specified time. HTTP response code will be &quot;408&quot;.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/ResponseTimeout.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code>route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResponseTimeout</span><span class="token punctuation">(</span><span class="token number">1000L</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="sessioncookie-middleware"><a href="#sessioncookie-middleware" class="header-anchor">#</a> SessionCookie Middleware</h3> <p>Generates Session Cookies, and sets the cookie header.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/session/SessionCookie.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// With &quot;JSESSIONID&quot; cookie</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SessionCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// With custom cookie name</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SessionCookie</span><span class="token punctuation">(</span><span class="token string">&quot;SID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The services.moleculer.web.middleware.session.<code>SessionHandler</code> object uses
&quot;beforeCall&quot; and &quot;afterCall&quot; hooks to store the &quot;$session&quot; structure of the request meta block.
By default, <code>SessionHandler</code> keeps the contents of the &quot;$session&quot; blocks in memory for a specified time.
<code>SessionHandler</code> looks for &quot;$session&quot; block based on the Session Cookie
and copies it to all HTTP requests for the Session. This feature requires SessionCookie <code>Middleware</code>
if the application is running on a Netty server (J2EE servers have their own cookie manager).</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">SessionHandler</span> sessionHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SessionHandler</span><span class="token punctuation">(</span>broker<span class="token punctuation">)</span><span class="token punctuation">;</span>
gateway<span class="token punctuation">.</span><span class="token function">setBeforeCall</span><span class="token punctuation">(</span>sessionHandler<span class="token punctuation">.</span><span class="token function">beforeCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gateway<span class="token punctuation">.</span><span class="token function">setAfterCall</span><span class="token punctuation">(</span>sessionHandler<span class="token punctuation">.</span><span class="token function">afterCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you need to perform other functions in the &quot;beforeCall&quot; or &quot;afterCall&quot; block,
you can call the <code>SessionHandler</code> as follows:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">SessionHandler</span> sessionHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SessionHandler</span><span class="token punctuation">(</span>broker<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CallProcessor</span>  loadSession    <span class="token operator">=</span> sessionHandler<span class="token punctuation">.</span><span class="token function">beforeCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gateway<span class="token punctuation">.</span><span class="token function">setBeforeCall</span><span class="token punctuation">(</span><span class="token punctuation">(</span>currentRoute<span class="token punctuation">,</span> req<span class="token punctuation">,</span> rsp<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    loadSession<span class="token punctuation">.</span><span class="token function">onCall</span><span class="token punctuation">(</span>currentRoute<span class="token punctuation">,</span> req<span class="token punctuation">,</span> rsp<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Other beforeCall&quot; functions...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">CallProcessor</span> saveSession <span class="token operator">=</span> sessionHandler<span class="token punctuation">.</span><span class="token function">afterCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gateway<span class="token punctuation">.</span><span class="token function">setBeforeCall</span><span class="token punctuation">(</span><span class="token punctuation">(</span>currentRoute<span class="token punctuation">,</span> req<span class="token punctuation">,</span> rsp<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    saveSession<span class="token punctuation">.</span><span class="token function">onCall</span><span class="token punctuation">(</span>currentRoute<span class="token punctuation">,</span> req<span class="token punctuation">,</span> rsp<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Other &quot;afterCall&quot; functions...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
</code></pre></div><p><code>Actions</code> access the persistent &quot;$session&quot; block as follows:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Action</span> action <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Get the persistent &quot;$session&quot; block</span>
    <span class="token class-name">Tree</span> meta <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">getMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Tree</span> session <span class="token operator">=</span> meta<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;$session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Read/write session data</span>
    <span class="token class-name">String</span> userID <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;userID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    session<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;now&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="toplevelcache-middleware"><a href="#toplevelcache-middleware" class="header-anchor">#</a> TopLevelCache Middleware</h3> <p>URL-based content cache. It is good for caching the responses of
non-authenticated REST services with large responses. For example, if the
service generates blog/wiki content using a HTML Template Egine. It is not
advisable to cache POST requests and/or requests that depend not only on the
URL but also on the content of the request. <code>TopLevelCache</code> speeds up querying
of various reports (tables, charts) and dynamically generated images.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/TopLevelCache.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// User default cacher of MessageBroker</span>
<span class="token class-name">Cacher</span> cacher <span class="token operator">=</span> broker<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TopLevelCache</span><span class="token punctuation">(</span>cacher<span class="token punctuation">,</span> <span class="token string">&quot;/blog/posts/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// User custom Cacher</span>
<span class="token class-name">Cacher</span> cacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemoryCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TopLevelCache</span><span class="token punctuation">(</span>cacher<span class="token punctuation">,</span> <span class="token string">&quot;/blog/posts/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="xsrftoken-middleware"><a href="#xsrftoken-middleware" class="header-anchor">#</a> XSRFToken Middleware</h3> <p>This middleware adds &quot;X-XSRF-TOKEN&quot; header to responses.
[<a href="https://github.com/moleculer-java/moleculer-java-web/blob/master/src/main/java/services/moleculer/web/middleware/XSRFToken.java" target="_blank" rel="noopener noreferrer">source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>]</p> <div class="language-java extra-class"><pre class="language-java"><code>route<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">XSRFToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="template-engines"><a href="#template-engines" class="header-anchor">#</a> Template Engines</h2> <p>Moleculer ApiGateway includes dynamic page generation capabilities by
including out of the box support for several popular template engines.
<code>Actions</code> basically return data in JSON format.
To convert the JSON data structure to HTML,
you must specify the template name in the <strong>&quot;$template&quot; meta property</strong>.
If there is a &quot;$template&quot; meta property in the <code>Action's</code> response,
<code>ApiGateway</code> calls the Template Engine and converts the response to HTML.
Example code that puts three values (&quot;a&quot;, &quot;b&quot;, and &quot;c&quot;) in the response JSON,
then creates a table and then converts this data with &quot;test.html&quot; template:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Action</span> html <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Add some value to &quot;raw&quot; JSON data,</span>
    <span class="token comment">// then create table (10 rows, 3 columns):</span>
    <span class="token comment">// {</span>
    <span class="token comment">//     &quot;a&quot;: 1,</span>
    <span class="token comment">//     &quot;b&quot;: true,</span>
    <span class="token comment">//     &quot;c&quot;: &quot;xyz&quot;,</span>
    <span class="token comment">//     &quot;table&quot;: [</span>
    <span class="token comment">//         { &quot;first&quot;: &quot;some text&quot;, &quot;second&quot;: false, &quot;third&quot;: 0 },</span>
    <span class="token comment">//         { &quot;first&quot;: &quot;some text&quot;, &quot;second&quot;: false, &quot;third&quot;: 1 },</span>
    <span class="token comment">//         { &quot;first&quot;: &quot;some text&quot;, &quot;second&quot;: false, &quot;third&quot;: 2 },</span>
    <span class="token comment">//         ...</span>
    <span class="token comment">//     ]</span>
    <span class="token comment">// }</span>
    <span class="token class-name">Tree</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xyz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Tree</span> table <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">putList</span><span class="token punctuation">(</span><span class="token string">&quot;table&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Tree</span> row <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">addMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        row<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;some text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        row<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;second&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        row<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;third&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Put template name (&quot;test.html&quot;) into the &quot;meta&quot;</span>
    <span class="token class-name">Tree</span> meta <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">getMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;$template&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Return data (and the &quot;meta&quot; in it)</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The Template Engine used by <code>ApiGateway</code> can be specified by the &quot;setTemplateEngine&quot; function of <code>ApiGateway</code>.
The following chapters describe how to configure the built-in Template Engines.</p> <h3 id="mustache-template-engine"><a href="#mustache-template-engine" class="header-anchor">#</a> Mustache Template Engine</h3> <p>Server-side template engine based on <a href="https://github.com/spullara/mustache.java" target="_blank" rel="noopener noreferrer">Mustache API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
Mustache is described as a &quot;logic-less&quot; system because it lacks any explicit control flow statements,
like if and else conditionals or for loops; however,
both looping and conditional evaluation can be achieved using section tags processing lists and lambdas.</p> <div class="custom-block warning"><p class="custom-block-title">Mustache dependencies</p> <p>To use Mustache Template Engine, add the following dependency to the build script:<br> <a href="https://mvnrepository.com/artifact/com.github.spullara.mustache.java/compiler" target="_blank" rel="noopener noreferrer">group: 'com.github.spullara.mustache.java', name: 'compiler', version: '0.9.6'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p><strong>Simple example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MustacheEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MustacheEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Root path of templates</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The &quot;setTemplatePath&quot; function defines the root directory of the templates.
This can be in the file system or on the classpath.</p> <p><strong>Advanced example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Development or production mode?</span>
<span class="token keyword">boolean</span> developmentMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// Create Mustache Template Engine</span>
<span class="token class-name">MustacheEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MustacheEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set basic properties</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// File or classpath to templates</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setReloadable</span><span class="token punctuation">(</span>developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setDefaultExtension</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Default extension</span>

<span class="token comment">// Set Mustache-specific properties</span>
<span class="token class-name">DefaultMustacheFactory</span> factory <span class="token operator">=</span> templateEngine<span class="token punctuation">.</span><span class="token function">getFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
factory<span class="token punctuation">.</span><span class="token function">setRecursionLimit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enable multilingualism, and language file reloading in development</span>
<span class="token comment">// mode (language files can be in YAML or Java Properties format)</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setMessageLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultMessageLoader</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;languages/messages&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Path and message file prefix</span>
                                <span class="token string">&quot;yml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Use YAML format (or use &quot;properties&quot; format)</span>
                                developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>

<span class="token comment">// Set the Template Engine of ApiGateway</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Sample template syntax</strong></p> <p>The &quot;header&quot; inserts a page snippet named &quot;header.html&quot; into the HTML page.
This &quot;header&quot; block will be included in every template example.<br> <a href="/site/moleculer-web.html#template-engines">The following template can be called with this code.</a></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        {{&gt; header}}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>A: {{a}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>B: {{b}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>C: {{c}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
        {{#table}}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{first}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{second}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{third}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        {{/table}}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="handlebars-template-engine"><a href="#handlebars-template-engine" class="header-anchor">#</a> Handlebars Template Engine</h3> <p>Server-side template engine based on <a href="https://github.com/jknack/handlebars.java" target="_blank" rel="noopener noreferrer">Handlebars API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
Handlebars is largely compatible with Mustache templates.
In most cases it is possible to swap out Mustache with Handlebars and continue using your current templates.</p> <div class="custom-block warning"><p class="custom-block-title">Handlebars dependencies</p> <p>To use Handlebars Template Engine, add the following dependency to the build script:<br> <a href="https://mvnrepository.com/artifact/com.github.jknack/handlebars" target="_blank" rel="noopener noreferrer">group: 'com.github.jknack', name: 'handlebars', version: '4.1.2'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p><strong>Simple example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">HandlebarsEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HandlebarsEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Root path of templates</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Advanced example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Development or production mode?</span>
<span class="token keyword">boolean</span> developmentMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// Create Handlebars Template Engine</span>
<span class="token class-name">HandlebarsEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HandlebarsEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set basic properties</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// File or classpath to templates</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setReloadable</span><span class="token punctuation">(</span>developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setDefaultExtension</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Default extension</span>

<span class="token comment">// Set Handlebars-specific properties</span>
<span class="token class-name">Handlebars</span> engine <span class="token operator">=</span> templateEngine<span class="token punctuation">.</span><span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
engine<span class="token punctuation">.</span><span class="token function">setInfiniteLoops</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
engine<span class="token punctuation">.</span><span class="token function">setParentScopeResolution</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enable multilingualism, and language file reloading in development</span>
<span class="token comment">// mode (language files can be in YAML or Java Properties format)</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setMessageLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultMessageLoader</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;languages/messages&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Path and message file prefix</span>
                                <span class="token string">&quot;yml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Use YAML format (or use &quot;properties&quot; format)</span>
                                developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>

<span class="token comment">// Set the Template Engine of ApiGateway</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Sample template syntax</strong></p> <p>The templates have the same syntax as the Mustache syntax.<br> <a href="/site/moleculer-web.html#template-engines">The following template can be called with this code.</a></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        {{&gt; header}}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>A: {{a}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>B: {{b}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>C: {{c}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
        {{#table}}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{first}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{second}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{third}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        {{/table}}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="datatree-template-engine"><a href="#datatree-template-engine" class="header-anchor">#</a> DataTree Template Engine</h3> <p>Server-side template engine based on <a href="https://github.com/berkesa/datatree-templates" target="_blank" rel="noopener noreferrer">DataTreeTemplates API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
Small and fast template engine capable of producing html, xml, and plain text files.
The template engine works with hierarchical collection structures - similar to the Mustache Engine but with expandable features.</p> <div class="custom-block warning"><p class="custom-block-title">DataTreeTemplates dependencies</p> <p>To use DataTree Template Engine, add the following dependency to the build script:<br> <a href="https://mvnrepository.com/artifact/com.github.berkesa/datatree-templates" target="_blank" rel="noopener noreferrer">group: 'com.github.berkesa', name: 'datatree-templates', version: '1.1.4'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p><strong>Simple example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataTreeEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataTreeEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Root path of templates</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Advanced example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Development or production mode?</span>
<span class="token keyword">boolean</span> developmentMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// Create DataTree Template Engine</span>
<span class="token class-name">DataTreeEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataTreeEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set basic properties</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// File or classpath to templates</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setReloadable</span><span class="token punctuation">(</span>developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setDefaultExtension</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Default extension</span>

<span class="token comment">// Set DataTree-specific properties</span>
<span class="token class-name">TemplateEngine</span> engine <span class="token operator">=</span> templateEngine<span class="token punctuation">.</span><span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
engine<span class="token punctuation">.</span><span class="token function">setTemplatePreProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleHtmlMinifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
<span class="token comment">// Enable multilingualism, and language file reloading in development</span>
<span class="token comment">// mode (language files can be in YAML or Java Properties format)</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setMessageLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultMessageLoader</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;languages/messages&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Path and message file prefix</span>
                                <span class="token string">&quot;yml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Use YAML format (or use &quot;properties&quot; format)</span>
                                developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>

<span class="token comment">// Set the Template Engine of ApiGateway</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Sample template syntax</strong></p> <p><a href="https://github.com/berkesa/datatree-templates#template-syntax" target="_blank" rel="noopener noreferrer">Learn more about DataTreeTemplates syntax.<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="/site/moleculer-web.html#template-engines">The following template can be called with this code.</a></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        #{include header}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>A: #{a}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>B: #{b}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>C: #{c}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
            #{for row : table}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>#{row.first}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>#{row.second}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>#{row.third}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>        
            #{end}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="freemarker-template-engine"><a href="#freemarker-template-engine" class="header-anchor">#</a> FreeMarker Template Engine</h3> <p>Server-side template engine based on <a href="https://freemarker.apache.org/" target="_blank" rel="noopener noreferrer">FreeMarker API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
Apache FreeMarker is a template engine:
a Java library to generate text output (HTML web pages, e-mails, configuration files, source code, etc.)
based on templates and changing data.
Templates are written in the FreeMarker Template Language (FTL), which is a simple, specialized language.</p> <div class="custom-block warning"><p class="custom-block-title">FreeMarker dependencies</p> <p>To use FreeMarker Template Engine, add the following dependency to the build script:<br> <a href="https://mvnrepository.com/artifact/org.freemarker/freemarker" target="_blank" rel="noopener noreferrer">group: 'org.freemarker', name: 'freemarker', version: '2.3.29'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p><strong>Simple example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">FreeMarkerEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FreeMarkerEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Root path of templates</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Advanced example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Development or production mode?</span>
<span class="token keyword">boolean</span> developmentMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// Create FreeMarker Template Engine</span>
<span class="token class-name">FreeMarkerEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FreeMarkerEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set basic properties</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// File or classpath to templates</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setReloadable</span><span class="token punctuation">(</span>developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setDefaultExtension</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Default extension</span>

<span class="token comment">// Set FreeMarker-specific properties</span>
<span class="token class-name">Configuration</span> config <span class="token operator">=</span> templateEngine<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span><span class="token function">setAutoFlush</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span><span class="token function">setLogTemplateExceptions</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
<span class="token comment">// Enable multilingualism, and language file reloading in development</span>
<span class="token comment">// mode (language files can be in YAML or Java Properties format)</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setMessageLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultMessageLoader</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;languages/messages&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Path and message file prefix</span>
                                <span class="token string">&quot;yml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Use YAML format (or use &quot;properties&quot; format)</span>
                                developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>

<span class="token comment">// Set the Template Engine of ApiGateway</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Sample template syntax</strong></p> <p><a href="/site/moleculer-web.html#template-engines">The following template can be called with this code.</a></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#include</span> <span class="token attr-name">&quot;header&quot;</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>A: ${a}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>B: ${b?string('true', 'false')}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>C: ${c}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#list</span> <span class="token attr-name">table</span> <span class="token attr-name">as</span> <span class="token attr-name">row</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>${row.first}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>${row.second?string('true', 'false')}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>${row.third}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>        
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>#list</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="jade-template-engine"><a href="#jade-template-engine" class="header-anchor">#</a> Jade Template Engine</h3> <p>Server-side template engine based on <a href="https://github.com/neuland/jade4j" target="_blank" rel="noopener noreferrer">Jade4J API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
Jade4J's intention is to be able to process Jade Templates in Java without the need of a JavaScript environment,
while being fully compatible with the original Jade syntax.</p> <div class="custom-block warning"><p class="custom-block-title">Jade dependencies</p> <p>To use Jade Template Engine, add the following dependency to the build script:<br> <a href="https://mvnrepository.com/artifact/de.neuland-bfi/jade4j" target="_blank" rel="noopener noreferrer">group: 'de.neuland-bfi', name: 'jade4j', version: '1.3.0'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p><strong>Simple example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">JadeEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JadeEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Root path of templates</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Advanced example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Development or production mode?</span>
<span class="token keyword">boolean</span> developmentMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// Create Jade Template Engine</span>
<span class="token class-name">JadeEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JadeEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set basic properties</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// File or classpath to templates</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setReloadable</span><span class="token punctuation">(</span>developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setDefaultExtension</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Default extension</span>

<span class="token comment">// Set Jade4J-specific properties</span>
<span class="token class-name">JadeConfiguration</span> config <span class="token operator">=</span> templateEngine<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span><span class="token function">setPrettyPrint</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config<span class="token punctuation">.</span><span class="token function">setMode</span><span class="token punctuation">(</span><span class="token class-name">Jade4J</span><span class="token punctuation">.</span><span class="token class-name">Mode</span><span class="token punctuation">.</span>HTML<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enable multilingualism, and language file reloading in development</span>
<span class="token comment">// mode (language files can be in YAML or Java Properties format)</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setMessageLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultMessageLoader</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;languages/messages&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Path and message file prefix</span>
                                <span class="token string">&quot;yml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Use YAML format (or use &quot;properties&quot; format)</span>
                                developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>

<span class="token comment">// Set the Template Engine of ApiGateway</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Sample template syntax</strong></p> <p><a href="/site/moleculer-web.html#template-engines">The following template can be called with this code.</a></p> <div class="language-jade extra-class"><pre class="language-text"><code>doctype html
html
  body
    include header
    p A: #{a}
    p B: #{b}
    p C: #{c}
    table
      for row in table
        tr
          td #{row.first}
          td #{row.second}
          td #{row.third}
</code></pre></div><h3 id="pebble-template-engine"><a href="#pebble-template-engine" class="header-anchor">#</a> Pebble Template Engine</h3> <p>Server-side template engine based on <a href="https://github.com/PebbleTemplates/pebble" target="_blank" rel="noopener noreferrer">Pebble API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
Pebble is a Java templating engine inspired by Twig and similar to the Python Jinja Template Engine syntax.
It features templates inheritance and easy-to-read syntax, ships with built-in autoescaping for security.</p> <div class="custom-block warning"><p class="custom-block-title">Pebble dependencies</p> <p>To use Pebble Template Engine, add the following dependency to the build script:<br> <a href="https://mvnrepository.com/artifact/com.mitchellbosecke/pebble" target="_blank" rel="noopener noreferrer">group: 'com.mitchellbosecke', name: 'pebble', version: '2.4.0'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p><strong>Simple example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">PebbleEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PebbleEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Root path of templates</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Advanced example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Development or production mode?</span>
<span class="token keyword">boolean</span> developmentMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// Create Pebble Template Engine</span>
<span class="token class-name">PebbleEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PebbleEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set basic properties</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// File or classpath to templates</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setReloadable</span><span class="token punctuation">(</span>developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setDefaultExtension</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Default extension</span>

<span class="token comment">// Enable multilingualism, and language file reloading in development</span>
<span class="token comment">// mode (language files can be in YAML or Java Properties format)</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setMessageLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultMessageLoader</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;languages/messages&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Path and message file prefix</span>
                                <span class="token string">&quot;yml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Use YAML format (or use &quot;properties&quot; format)</span>
                                developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>

<span class="token comment">// Set the Template Engine of ApiGateway</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Sample template syntax</strong></p> <p><a href="/site/moleculer-web.html#template-engines">The following template can be called with this code.</a></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        {% include &quot;header&quot; %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>A: {{a}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>B: {{b}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>C: {{c}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
        {% for row in table %}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{row.first}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{row.second}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{row.third}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        {% endfor %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="thymeleaf-template-engine"><a href="#thymeleaf-template-engine" class="header-anchor">#</a> Thymeleaf Template Engine</h3> <p>Server-side template engine based on <a href="https://www.thymeleaf.org/" target="_blank" rel="noopener noreferrer">Thymeleaf API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
Thymeleaf's main goal is to bring elegant <em>natural templates</em> to your development workflow —
HTML that can be correctly displayed in browsers and also work as static prototypes,
allowing for stronger collaboration in development teams.</p> <div class="custom-block warning"><p class="custom-block-title">Thymeleaf dependencies</p> <p>To use Thymeleaf Template Engine, add the following dependency to the build script:<br> <a href="https://mvnrepository.com/artifact/org.thymeleaf/thymeleaf" target="_blank" rel="noopener noreferrer">group: 'org.thymeleaf', name: 'thymeleaf', version: '3.0.11.RELEASE'<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p><strong>Simple example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ThymeleafEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThymeleafEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Root path of templates</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Advanced example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Development or production mode?</span>
<span class="token keyword">boolean</span> developmentMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// Create Thymeleaf Template Engine</span>
<span class="token class-name">ThymeleafEngine</span> templateEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThymeleafEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set basic properties</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setTemplatePath</span><span class="token punctuation">(</span><span class="token string">&quot;/www&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// File or classpath to templates</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setReloadable</span><span class="token punctuation">(</span>developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setDefaultExtension</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Default extension</span>

<span class="token comment">// Set Thymeleaf-specific properties</span>
<span class="token class-name">TemplateEngine</span> engine <span class="token operator">=</span> templateEngine<span class="token punctuation">.</span><span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
engine<span class="token punctuation">.</span><span class="token function">setLinkBuilder</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enable multilingualism, and language file reloading in development</span>
<span class="token comment">// mode (language files can be in YAML or Java Properties format)</span>
templateEngine<span class="token punctuation">.</span><span class="token function">setMessageLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultMessageLoader</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;languages/messages&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Path and message file prefix</span>
                                <span class="token string">&quot;yml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Use YAML format (or use &quot;properties&quot; format)</span>
                                developmentMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Autoreload on/off</span>

<span class="token comment">// Set the Template Engine of ApiGateway</span>
gateway<span class="token punctuation">.</span><span class="token function">setTemplateEngine</span><span class="token punctuation">(</span>templateEngine<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Sample template syntax</strong></p> <p><a href="/site/moleculer-web.html#template-engines">The following template can be called with this code.</a></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${a}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${b}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${c}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>row : ${table}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${row.first}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${row.second}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${row.third}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="internationalization-i18n"><a href="#internationalization-i18n" class="header-anchor">#</a> Internationalization (i18n)</h2> <p>All template engines that can be used with Moleculer support multilingual interfaces.
This requires passing an object called <code>MessageLoader</code> to <code>TemplateEngine</code>.
You can write your own <code>MessageLoader</code> or use the <code>DefaultMessageLoader</code> class:</p> <div class="language-java extra-class"><pre class="language-java"><code>templateEngine<span class="token punctuation">.</span><span class="token function">setMessageLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultMessageLoader</span><span class="token punctuation">(</span>
                                <span class="token string">&quot;languages/messages&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Path and message file prefix</span>
                                <span class="token string">&quot;yml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Use YAML format (or use &quot;properties&quot; format)</span>
                                enableReload<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reloadable (turn off in &quot;production&quot; stage)</span>
</code></pre></div><p>In the code snippet above, the <code>DefaultMessageLoader</code> loads the message files from the &quot;languages&quot; directory.
The <code>DefaultMessageLoader</code> can load this directory from the classpath or from the file system.
Each file starts with the &quot;messages&quot; prefix,
then comes the optional language code (eg. &quot;-en&quot;, &quot;-en-uk&quot;, &quot;-en-us&quot;, etc.) and then the extension (&quot;.yml&quot;).
The message file for the default language is &quot;messages.yml&quot;.
The language files are in YAML format, with key-value pairs under the &quot;msg&quot; block:</p> <div class="language- extra-class"><pre class="language-text"><code>msg:
  title: Server-side rendering
  first: First
  previous: Previous
  back: Back to main menu
</code></pre></div><p>For example the German language file is named &quot;messages-de.yml&quot;,
located in the same directory as the default language file, and looks like this:</p> <div class="language- extra-class"><pre class="language-text"><code>msg:
  title: Serverseitige rendering
  first: Erst
  previous: Vorherigen
  back: Zurück zum Hauptmenü
</code></pre></div><p>Similarly, the structure of the Korean language file (&quot;messages-ko.yml&quot;) is as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>msg:
  title: 서버 측 렌더링
  first: 먼저
  previous: 이전
  back: 메인 메뉴로 돌아 가기
</code></pre></div><p>The final (used for generating) language file consists of <strong>multiple layers</strong>:</p> <p>If the language of template is French Canadian (&quot;fr-ca&quot;)
the language file loader will load the default language file (&quot;messages.yml&quot;) first.
If it exists, it loads the French language file (&quot;messages-fr.yml&quot;).
Then, if it exists, it loads the French Canadian language file (&quot;messages-fr-ca.yml&quot;).
Then use the union of the three files (or as many as exist) to generate the template.</p> <p>Therefore, it is not necessary to copy all message entries in the language files,
only those that have changed compared to the &quot;higher level&quot; language file.<br> <a href="https://github.com/moleculer-java/moleculer-spring-boot-demo/tree/master/src/main/resources/languages" target="_blank" rel="noopener noreferrer">There are some sample language files in this directory.<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Templates should refer to language constants as a common variable whose name begins with &quot;msg.&quot;:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#{msg.first}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The insertion of variables for each template works according to their own syntax:</p> <ul><li>Pebble, Mustache and Handlebars syntax: { {msg.first} }</li> <li>Jade and DataTree syntax: #{msg.first}</li> <li>Thymeleaf and FreeMarker syntax: ${msg.first}</li></ul> <p>Language files can contain not only name-value pairs but also
<a href="https://github.com/moleculer-java/moleculer-spring-boot-demo/blob/master/src/main/resources/languages/messages.yml#L18" target="_blank" rel="noopener noreferrer">hierarchical structures<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
(such as the contents of drop-down lists).
For the language dependent HTML conversion add the &quot;$template&quot; and &quot;$location&quot; values to the &quot;meta&quot; block of the returned <code>Tree</code> structure:</p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-java"><code><span class="token class-name">Action</span> html <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Create response JSON object</span>
    <span class="token class-name">Tree</span> rsp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... fill the &quot;rsp&quot; with data ...</span>
    
    <span class="token comment">// The template is &quot;/pages/index.html&quot;,</span>
    <span class="token comment">// and the language is Canadian French:</span>
    <span class="token class-name">Tree</span> meta <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">getMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;$template&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meta<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;$locale&quot;</span><span class="token punctuation">,</span>   <span class="token string">&quot;ca-fr&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> rsp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="websocket-handling"><a href="#websocket-handling" class="header-anchor">#</a> WebSocket handling</h2> <p>WebSocket is a HTTP-based protocol, providing realtime communication between the server and browser.
The Moleculer API Gateway WebSocket implementation <strong>works the same</strong> on all J2EE servers (Servlet containers) and Netty (in &quot;standalone&quot; run mode).
The WebSocket communication implemented by Moleculer is <strong>not duplex</strong>,
it can only send a message from the server to the browser (or other WebSocket client API).
Reverse (client-to-server) communication is possible <strong>with REST</strong> requests.
Both ways of communication can pass through HTTP firewalls.</p> <p>You can send WebSocket messages from anywhere in the application using Moleculer events.
It is mandatory to insert a &quot;path&quot; and a &quot;data&quot; block in the event.
The &quot;path&quot; is the URL to which the WebSocket client is connected,
and &quot;data&quot; is the data block sent to the client.
The &quot;data&quot; block may contain any structure.
For example, the following structure is sent to clients that are connected to the URL &quot;http://host:port/ws/chat&quot;:</p> <div class="language-json extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ws/chat&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;command1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sample&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The above WebSocket message can be sent by broadcasting it as a &quot;websocket.send&quot; event:</p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br></div><pre class="language-java"><code><span class="token class-name">Tree</span> packet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
packet<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ws/chat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
packet<span class="token punctuation">.</span><span class="token function">putMap</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;command&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;sample&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
broker<span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token string">&quot;websocket.send&quot;</span><span class="token punctuation">,</span> packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The &quot;websocket.send&quot; event is monitored by the API Gateway and, when such an event occurs,
it forwards its content to the appropriate WebSocket clients.
In the case of a browser, the WebSocket client is
<a href="https://github.com/moleculer-java/moleculer-spring-boot-demo/blob/master/src/main/resources/www/js/websocket.js" target="_blank" rel="noopener noreferrer">this JavaScript module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
.</p> <p>The HTML page must include the WebSocket API (&quot;websocket.js&quot;)
and the &quot;app.js&quot; application that processes incoming messages:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>	
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>websocket.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>outDiv<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>WebSocket Sample<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The structure of &quot;app.js&quot; that processes messages is similar to the following:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// Netty or J2EE WebSocket connection</span>
<span class="token keyword">var</span> ws<span class="token punctuation">;</span>

<span class="token comment">// Handle connect</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ws <span class="token operator">=</span> <span class="token function">MoleculerWebsocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws/chat&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		<span class="token comment">// Message received from server;</span>
		<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&quot;command&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">var</span> outDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;outDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            outDiv<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> data<span class="token punctuation">.</span>sample<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
				
		<span class="token comment">// Set the WebSocket connection parameters</span>
		heartbeatInterval<span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
		heartbeatTimeout<span class="token operator">:</span>  <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
		debug<span class="token operator">:</span> <span class="token boolean">true</span>
		
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ws<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Handle disconnect</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;unload&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ws<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ws<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ws <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The first parameter of &quot;MoleculerWebsocket&quot; is the URL that WebSocket will connected to (&quot;ws/chat&quot;).
The use of the &quot;type&quot; parameter is optional,
but can facilitate the processing of messages.
For each type of data packet,
we place different &quot;type&quot; parameter on the server side (eg. &quot;command1&quot;, &quot;command2&quot;, &quot;command3&quot;).
And in the browser, we can decide what to do by the value of the &quot;type&quot;.</p> <p>The
<a href="/site/http-client.html#receiving-websocket-messages">HTTP Client API</a>
allows a Java Program to connect to the server via WebSocket.
As with browser communication, this connection works over an HTTP firewall.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/moleculer-java/site/edit/master/src/moleculer-web.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/14/2020, 6:37:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/site/fault-tolerance.html" class="prev">Fault tolerance</a></span> <span class="next"><a href="/site/moleculer-repl.html">Moleculer REPL</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/site/assets/js/app.6458ec54.js" defer></script><script src="/site/assets/js/2.b39afa1e.js" defer></script><script src="/site/assets/js/21.f5bda656.js" defer></script>
  </body>
</html>
