<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>About MongoDB Client | Moleculer</title>
    <meta name="description" content="Progressive microservices framework for Java">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/site/assets/css/0.styles.f35a1954.css" as="style"><link rel="preload" href="/site/assets/js/app.8d6011a2.js" as="script"><link rel="preload" href="/site/assets/js/2.b39afa1e.js" as="script"><link rel="preload" href="/site/assets/js/22.baf3db37.js" as="script"><link rel="prefetch" href="/site/assets/js/10.7c5c0272.js"><link rel="prefetch" href="/site/assets/js/11.4379bac2.js"><link rel="prefetch" href="/site/assets/js/12.4d6ab440.js"><link rel="prefetch" href="/site/assets/js/13.ba2d1119.js"><link rel="prefetch" href="/site/assets/js/14.841a570c.js"><link rel="prefetch" href="/site/assets/js/15.c17e30dc.js"><link rel="prefetch" href="/site/assets/js/16.3cd01916.js"><link rel="prefetch" href="/site/assets/js/17.67be987e.js"><link rel="prefetch" href="/site/assets/js/18.d178613d.js"><link rel="prefetch" href="/site/assets/js/19.fd15d80a.js"><link rel="prefetch" href="/site/assets/js/20.aca4251c.js"><link rel="prefetch" href="/site/assets/js/21.7b943fea.js"><link rel="prefetch" href="/site/assets/js/23.35b896e7.js"><link rel="prefetch" href="/site/assets/js/24.dcfe8fa4.js"><link rel="prefetch" href="/site/assets/js/25.991459d5.js"><link rel="prefetch" href="/site/assets/js/26.dcebd387.js"><link rel="prefetch" href="/site/assets/js/27.f09918ca.js"><link rel="prefetch" href="/site/assets/js/28.f634c817.js"><link rel="prefetch" href="/site/assets/js/29.2d4217a8.js"><link rel="prefetch" href="/site/assets/js/3.b78c1751.js"><link rel="prefetch" href="/site/assets/js/4.3e9b503d.js"><link rel="prefetch" href="/site/assets/js/5.51cf4fa4.js"><link rel="prefetch" href="/site/assets/js/6.3b8f5b4e.js"><link rel="prefetch" href="/site/assets/js/7.2ec3348e.js"><link rel="prefetch" href="/site/assets/js/8.3c77073e.js"><link rel="prefetch" href="/site/assets/js/9.e47a2a91.js">
    <link rel="stylesheet" href="/site/assets/css/0.styles.f35a1954.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/site/" class="home-link router-link-active"><img src="logo.png" alt="Moleculer" class="logo"> <span class="site-name can-hide">Moleculer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div><div class="nav-item"><a href="https://www.patreon.com/berkesa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Donate
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div><div class="nav-item"><a href="https://www.patreon.com/berkesa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Donate
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Moleculer core</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Clustering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/site/moleculer-web.html" class="sidebar-link">Web API Gateway</a></li><li><a href="/site/moleculer-repl.html" class="sidebar-link">Moleculer REPL</a></li><li><a href="/site/mongo-client.html" class="active sidebar-link">MongoDB client</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/mongo-client.html#about-mongodb-client" class="sidebar-link">About MongoDB Client</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#download" class="sidebar-link">Download</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#usage-without-spring-framework" class="sidebar-link">Usage without Spring Framework</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#usage-with-spring-framework" class="sidebar-link">Usage with Spring Framework</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#usage-with-moleculer-framework" class="sidebar-link">Usage with Moleculer Framework</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#parallel-processing" class="sidebar-link">Parallel processing</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#dao-methods" class="sidebar-link">DAO methods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/mongo-client.html#drop-collection" class="sidebar-link">Drop collection</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#rename-collection" class="sidebar-link">Rename collection</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#create-indexes" class="sidebar-link">Create indexes</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#list-indexes" class="sidebar-link">List indexes</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#insert-one-document" class="sidebar-link">Insert one document</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#replace-one-document" class="sidebar-link">Replace one document</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#update-one-document" class="sidebar-link">Update one document</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#update-many-documents" class="sidebar-link">Update many documents</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#delete-one-document" class="sidebar-link">Delete one document</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#delete-all-documents" class="sidebar-link">Delete all documents</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#delete-many-documents" class="sidebar-link">Delete many documents</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#count-documents" class="sidebar-link">Count documents</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#find-one-document" class="sidebar-link">Find one document</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#find-many-documents" class="sidebar-link">Find many documents</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#find-one-and-delete" class="sidebar-link">Find one and delete</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#find-one-and-replace" class="sidebar-link">Find one and replace</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#find-one-and-update" class="sidebar-link">Find one and update</a></li><li class="sidebar-sub-header"><a href="/site/mongo-client.html#map-reduce" class="sidebar-link">Map/Reduce</a></li></ul></li></ul></li><li><a href="/site/http-client.html" class="sidebar-link">HTTP client</a></li><li><a href="/site/jmx-service.html" class="sidebar-link">JMX Service</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="about-mongodb-client"><a href="#about-mongodb-client" class="header-anchor">#</a> About MongoDB Client</h2> <p>The &quot;moleculer-java-mongo&quot; is an asynchronous
<a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer">MongoDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
client, specially designed for Java-based Moleculer Ecosystem.
The API can be conveniently used with the Spring Framework (but it works without Spring).</p> <h2 id="download"><a href="#download" class="header-anchor">#</a> Download</h2> <p><strong>Maven</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.berkesa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>moleculer-java-mongo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Gradle</strong></p> <div class="language-gradle extra-class"><pre class="language-text"><code>dependencies {
	implementation group: 'com.github.berkesa', name: 'moleculer-java-mongo', version: '1.0.0' 
}
</code></pre></div><h2 id="usage-without-spring-framework"><a href="#usage-without-spring-framework" class="header-anchor">#</a> Usage without Spring Framework</h2> <p>The key Superclass is the &quot;MongoDAO&quot;. All DAO objects are inherited from this Class.
The name of the Mongo Collection can be specified by the annotation &quot;MongoCollection&quot;.
The functions run in non-blocking mode, so all return types are Promise:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>datatree</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">services<span class="token punctuation">.</span>moleculer<span class="token punctuation">.</span>mongo</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@MongoCollection</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDAO</span> <span class="token keyword">extends</span> <span class="token class-name">MongoDAO</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token class-name">Promise</span> <span class="token function">createNewUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span> <span class="token class-name">String</span> lastName<span class="token punctuation">,</span> <span class="token class-name">String</span> email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Tree</span> document <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		document<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> firstName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		document<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lastName&quot;</span><span class="token punctuation">,</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		document<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">insertOne</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Promise</span> <span class="token function">getUserByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Promise</span> <span class="token function">deleteUserByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Promise</span> <span class="token function">countUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>
</code></pre></div><p>The use of the UserDAO is illustrated by the following example (without Spring):</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

	<span class="token comment">// Create MongoDB connection pool</span>
	<span class="token class-name">MongoConnectionPool</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoConnectionPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	connection<span class="token punctuation">.</span><span class="token function">setConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;mongodb://localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	connection<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token string">&quot;db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	connection<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Create DAO Object and set the MongoDB connection pool</span>
	<span class="token class-name">UserDAO</span> userDAO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	userDAO<span class="token punctuation">.</span><span class="token function">setMongoConnectionPool</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Example of blocking-style processing</span>
	<span class="token class-name">Tree</span> count <span class="token operator">=</span> userDAO<span class="token punctuation">.</span><span class="token function">countUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Number of users: &quot;</span> <span class="token operator">+</span> count<span class="token punctuation">.</span><span class="token function">asInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Non-blocking, &quot;waterfall-style&quot; processing (this is the recommended)</span>
	<span class="token class-name">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

		<span class="token comment">// Create new user</span>
		<span class="token keyword">return</span> userDAO<span class="token punctuation">.</span><span class="token function">createNewUser</span><span class="token punctuation">(</span><span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tom.smith@company.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

		<span class="token comment">// Get the new record ID</span>
		<span class="token class-name">String</span> id <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;New record ID: &quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

		<span class="token comment">// Find new user</span>
		<span class="token keyword">return</span> userDAO<span class="token punctuation">.</span><span class="token function">getUserByEmail</span><span class="token punctuation">(</span><span class="token string">&quot;tom.smith@company.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

		<span class="token comment">// Print a property from the retrieved record</span>
		<span class="token class-name">String</span> firstName <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;First name: &quot;</span> <span class="token operator">+</span> firstName<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

		<span class="token comment">// Delete record</span>
		<span class="token keyword">return</span> userDAO<span class="token punctuation">.</span><span class="token function">deleteUserByEmail</span><span class="token punctuation">(</span><span class="token string">&quot;tom.smith@company.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

		<span class="token comment">// Print the result of the previous operation</span>
		<span class="token keyword">int</span> numberOfDeletedRecords <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;deleted&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Success: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>numberOfDeletedRecords <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catchError</span><span class="token punctuation">(</span>err <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

		<span class="token comment">// Error handler</span>
		err<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;End of process.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Wait for few second before terminate the JVM</span>
	<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="usage-with-spring-framework"><a href="#usage-with-spring-framework" class="header-anchor">#</a> Usage with Spring Framework</h2> <p>When using the Spring Framework, you can create the MongoDB Connection Pool as Spring Bean:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mongoPool<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>services.moleculer.mongo.MongoConnectionPool<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>init<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>destroy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>connectionString<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mongodb://localhost<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>database<span class="token punctuation">&quot;</span></span>          <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>db<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>connectionTimeout<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>3000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>This case is different from using without Spring Framework in that
the DAO classes are inherited from &quot;SpringMongoDAO&quot;,
and the stereotype of the DAO classes is &quot;Repository&quot;:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>datatree</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">services<span class="token punctuation">.</span>moleculer<span class="token punctuation">.</span>mongo</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Repository</span>
<span class="token annotation punctuation">@MongoConnection</span><span class="token punctuation">(</span><span class="token string">&quot;mongoPool&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@MongoCollection</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDAO</span> <span class="token keyword">extends</span> <span class="token class-name">SpringMongoDAO</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token class-name">Promise</span> <span class="token function">createNewUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span> <span class="token class-name">String</span> lastName<span class="token punctuation">,</span> <span class="token class-name">String</span> email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Tree</span> document <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		document<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> firstName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		document<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lastName&quot;</span><span class="token punctuation">,</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		document<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">insertOne</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Promise</span> <span class="token function">getUserByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">Promise</span> <span class="token function">deleteUserByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Promise</span> <span class="token function">countUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>
</code></pre></div><p>MongoDAOs can be used like any other Spring Beans,
with the &quot;Autowired&quot; annotation any other Spring Bean can refer to them:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">UserDAO</span> userDAO<span class="token punctuation">;</span>
</code></pre></div><h2 id="usage-with-moleculer-framework"><a href="#usage-with-moleculer-framework" class="header-anchor">#</a> Usage with Moleculer Framework</h2> <p>Moleculer Framework allows you to build a distributed service-based application that uses MongoDB as a back-end.
An example of a Moleculer-based service available through Message Broker (eg. Redis or NATS) and via HTTP REST call:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">services<span class="token punctuation">.</span>moleculer<span class="token punctuation">.</span>service</span><span class="token punctuation">.</span><span class="token class-name">Action</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">services<span class="token punctuation">.</span>moleculer<span class="token punctuation">.</span>service</span><span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">services<span class="token punctuation">.</span>moleculer<span class="token punctuation">.</span>service</span><span class="token punctuation">.</span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">services<span class="token punctuation">.</span>moleculer<span class="token punctuation">.</span>web<span class="token punctuation">.</span>router</span><span class="token punctuation">.</span><span class="token class-name">HttpAlias</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Name</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">UserDAO</span> userDAO<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Name</span><span class="token punctuation">(</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@HttpAlias</span><span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">&quot;api/user/create&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Action</span> createNewUser <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

		<span class="token comment">// Get input parameter</span>
		<span class="token class-name">String</span> firstName <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> lastName <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;lastName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> email <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Verify input parameters</span>
		<span class="token comment">// ...</span>

		<span class="token comment">// Invoke UserDAO</span>
		<span class="token keyword">return</span> userDAO<span class="token punctuation">.</span><span class="token function">createNewUser</span><span class="token punctuation">(</span>firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>The REST part (the &quot;HttpAlias&quot; annotation) is optional in the code above.
However, if you want to build REST services, you'll need the
<a href="/site/moleculer-web.html#about-api-gateway">API Gateway</a>
dependency. From another Moleculer service (even from another host) you can
use the service above with the following code:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span>
                         <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">transporter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NatsTransporter</span><span class="token punctuation">(</span><span class="token string">&quot;nats://host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

broker<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;user.create&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;lastName&quot;</span><span class="token punctuation">,</span>  <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>     <span class="token string">&quot;tom.smith@company.com&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

          <span class="token comment">// User created successfully</span>
          <span class="token class-name">String</span> recordID <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    	  
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="parallel-processing"><a href="#parallel-processing" class="header-anchor">#</a> Parallel processing</h2> <p>Parallel queries make sense when using clustered MongoDB.
If the queries are independent, they can be started at the same time.
The &quot;Promise.all&quot; function waits for all replies to be received:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Promise</span> p1 <span class="token operator">=</span> userDAO<span class="token punctuation">.</span><span class="token function">getUserByEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Promise</span> p2 <span class="token operator">=</span> roleDAO<span class="token punctuation">.</span><span class="token function">getRolesByEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Promise</span> p3 <span class="token operator">=</span> postsDAO<span class="token punctuation">.</span><span class="token function">getPostsByEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

  <span class="token class-name">Tree</span> users <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Tree</span> roles <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Tree</span> posts <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="dao-methods"><a href="#dao-methods" class="header-anchor">#</a> DAO methods</h2> <h3 id="drop-collection"><a href="#drop-collection" class="header-anchor">#</a> Drop collection</h3> <p>Drops this collection from the Database.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Drop operation finished</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catchError</span><span class="token punctuation">(</span>err <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// Error handler</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="rename-collection"><a href="#rename-collection" class="header-anchor">#</a> Rename collection</h3> <p>Rename the collection.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">renameCollection</span><span class="token punctuation">(</span><span class="token string">&quot;db&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;collection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Rename operation finished</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="create-indexes"><a href="#create-indexes" class="header-anchor">#</a> Create indexes</h3> <p>Creates ascending/descending/2dsphere/hash/text/etc. indexes.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">createAscendingIndexes</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;field2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Index created successfully</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="list-indexes"><a href="#list-indexes" class="header-anchor">#</a> List indexes</h3> <p>Get all the indexes in this collection.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">listIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Operation finished</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Tree</span> index<span class="token operator">:</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;rows&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">int</span> numberOfIndexes <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The answer (the &quot;res&quot; JSON) will be similar to the following structure:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;rows&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;_id&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;_id_&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;ns&quot;</span><span class="token operator">:</span><span class="token string">&quot;db.test&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;v&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">&quot;a&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;a_1&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;ns&quot;</span><span class="token operator">:</span><span class="token string">&quot;db.test&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="insert-one-document"><a href="#insert-one-document" class="header-anchor">#</a> Insert one document</h3> <p>Inserts the provided document. If the document is missing an identifier, the driver should generate one.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Tree</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;field2.subfield&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">insertOne</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Insert operation finished</span>
 <span class="token comment">// The &quot;res&quot; is a JSON structure,</span>
 <span class="token comment">// with the inserted document + the &quot;_id&quot; field</span>
 
 <span class="token class-name">String</span> id <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> id<span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="replace-one-document"><a href="#replace-one-document" class="header-anchor">#</a> Replace one document</h3> <p>Replace a document in the collection according to the specified arguments.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Tree</span> replacement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
replacement<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">345</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">replaceOne</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Replace operation finished</span>
 <span class="token keyword">int</span> modified <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;modified&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> modified <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="update-one-document"><a href="#update-one-document" class="header-anchor">#</a> Update one document</h3> <p>Update a single document in the collection according to the specified arguments.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Tree</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
update<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">345</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Replace operation finished</span>
 <span class="token keyword">int</span> modified <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;modified&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> modified <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The answer (the &quot;res&quot; JSON) will be similar to the following structure:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;matched&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token property">&quot;modified&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token property">&quot;acknowledged&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="update-many-documents"><a href="#update-many-documents" class="header-anchor">#</a> Update many documents</h3> <p>Update all documents in the collection according to the specified arguments.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Tree</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
update<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">345</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Replace operation finished</span>
 <span class="token keyword">int</span> modified <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;modified&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> modified <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="delete-one-document"><a href="#delete-one-document" class="header-anchor">#</a> Delete one document</h3> <p>Removes at most one document from the collection that matches the given filter.
If no documents match, the collection is not modified.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Delete operation finished</span>
 <span class="token keyword">int</span> deleted <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;deleted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> deleted <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The answer (the &quot;res&quot; JSON) will be similar to the following structure:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;deleted&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;acknowledged&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="delete-all-documents"><a href="#delete-all-documents" class="header-anchor">#</a> Delete all documents</h3> <p>Removes all documents from the collection.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Delete operation finished</span>
 <span class="token keyword">int</span> deleted <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;deleted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> deleted <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
	 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="delete-many-documents"><a href="#delete-many-documents" class="header-anchor">#</a> Delete many documents</h3> <p>Removes all documents from the collection that match the given query filter.
If no documents match, the collection is not modified.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Delete operation finished</span>
 <span class="token keyword">int</span> deleted <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;deleted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> deleted <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-documents"><a href="#count-documents" class="header-anchor">#</a> Count documents</h3> <p>Counts the number of documents in the collection according to the given filters.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">count</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Count operation finished</span>
 <span class="token keyword">long</span> numberOfDocuments <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">asLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> res<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="find-one-document"><a href="#find-one-document" class="header-anchor">#</a> Find one document</h3> <p>Finds one document by the specified query filter.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Find operation finished</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> firstName <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> age <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> res<span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="find-many-documents"><a href="#find-many-documents" class="header-anchor">#</a> Find many documents</h3> <p>Queries the specified number of records from the collection.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Find operation finished</span>
 <span class="token keyword">int</span> maxNumberOfSelectableDocuments <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Tree</span> doc<span class="token operator">:</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;rows&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> firstName <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> res<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The answer (the &quot;res&quot; JSON) will be similar to the following structure:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span><span class="token number">10345</span><span class="token punctuation">,</span>
  <span class="token property">&quot;rows&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;firstName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;lastName&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;email&quot;</span><span class="token operator">:</span>     <span class="token string">&quot;tom.smith@company.com&quot;</span>
    <span class="token punctuation">}</span>    
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The &quot;count&quot; field contains the max number of rows which meets the &quot;filter&quot; condition
(can be much more than the number of records in the &quot;rows&quot; structure).</p> <h3 id="find-one-and-delete"><a href="#find-one-and-delete" class="header-anchor">#</a> Find one and delete</h3> <p>Atomically find a document and remove it. The answer structure is the searched document, or null.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">findOneAndDelete</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Delete operation finished</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> firstName <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> age <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> res<span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="find-one-and-replace"><a href="#find-one-and-replace" class="header-anchor">#</a> Find one and replace</h3> <p>Atomically find a document and replace it.
The answer structure is the searched document, or null.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Tree</span> replacement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
replacement<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">345</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">findOneAndReplace</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span> replacement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Replace operation finished</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> firstName <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> age <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> res<span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="find-one-and-update"><a href="#find-one-and-update" class="header-anchor">#</a> Find one and update</h3> <p>Atomically find a document and update it.
The answer structure is the searched document, or null.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Tree</span> update <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
update<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">345</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;field1&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Update operation finished</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">String</span> firstName <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> age <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> res<span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="map-reduce"><a href="#map-reduce" class="header-anchor">#</a> Map/Reduce</h3> <p>Aggregates documents according to the specified map-reduce function.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> mapFunction <span class="token operator">=</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// JavaScript</span>
<span class="token class-name">String</span> reduceFunction <span class="token operator">=</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">;</span> <span class="token comment">// JavaScript</span>
<span class="token function">mapReduce</span><span class="token punctuation">(</span>mapFunction<span class="token punctuation">,</span> reduceFunction<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

 <span class="token comment">// Operation finished</span>
 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/moleculer-java/site/edit/master/src/mongo-client.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/4/2020, 6:35:35 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/site/moleculer-repl.html" class="prev">Moleculer REPL</a></span> <span class="next"><a href="/site/http-client.html">HTTP client</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/site/assets/js/app.8d6011a2.js" defer></script><script src="/site/assets/js/2.b39afa1e.js" defer></script><script src="/site/assets/js/22.baf3db37.js" defer></script>
  </body>
</html>
