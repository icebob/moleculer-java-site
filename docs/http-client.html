<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>About the Async HTTP Client | Moleculer</title>
    <meta name="description" content="Progressive microservices framework for Java">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/site/assets/css/0.styles.f35a1954.css" as="style"><link rel="preload" href="/site/assets/js/app.175d518a.js" as="script"><link rel="preload" href="/site/assets/js/2.b39afa1e.js" as="script"><link rel="preload" href="/site/assets/js/13.3a579dc3.js" as="script"><link rel="prefetch" href="/site/assets/js/10.bfb608ff.js"><link rel="prefetch" href="/site/assets/js/11.3ea3085b.js"><link rel="prefetch" href="/site/assets/js/12.b93967c0.js"><link rel="prefetch" href="/site/assets/js/14.4851fec0.js"><link rel="prefetch" href="/site/assets/js/15.7de5dc7f.js"><link rel="prefetch" href="/site/assets/js/16.c5d17348.js"><link rel="prefetch" href="/site/assets/js/17.577023e6.js"><link rel="prefetch" href="/site/assets/js/18.e0b6e477.js"><link rel="prefetch" href="/site/assets/js/19.d725b59d.js"><link rel="prefetch" href="/site/assets/js/20.aca4251c.js"><link rel="prefetch" href="/site/assets/js/21.a20d551f.js"><link rel="prefetch" href="/site/assets/js/22.1961a5ad.js"><link rel="prefetch" href="/site/assets/js/23.207fed60.js"><link rel="prefetch" href="/site/assets/js/24.3eaebbbc.js"><link rel="prefetch" href="/site/assets/js/25.a5626dba.js"><link rel="prefetch" href="/site/assets/js/26.cc18da0e.js"><link rel="prefetch" href="/site/assets/js/27.345662a2.js"><link rel="prefetch" href="/site/assets/js/28.564b5a93.js"><link rel="prefetch" href="/site/assets/js/29.2d4217a8.js"><link rel="prefetch" href="/site/assets/js/3.b78c1751.js"><link rel="prefetch" href="/site/assets/js/4.3e9b503d.js"><link rel="prefetch" href="/site/assets/js/5.51cf4fa4.js"><link rel="prefetch" href="/site/assets/js/6.ade6692f.js"><link rel="prefetch" href="/site/assets/js/7.a87203b9.js"><link rel="prefetch" href="/site/assets/js/8.48012805.js"><link rel="prefetch" href="/site/assets/js/9.e47a2a91.js">
    <link rel="stylesheet" href="/site/assets/css/0.styles.f35a1954.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/site/" class="home-link router-link-active"><img src="logo.png" alt="Moleculer" class="logo"> <span class="site-name can-hide">Moleculer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div><div class="nav-item"><a href="https://www.patreon.com/berkesa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Donate
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div><div class="nav-item"><a href="https://www.patreon.com/berkesa" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Donate
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Moleculer core</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Clustering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/site/moleculer-web.html" class="sidebar-link">Web API Gateway</a></li><li><a href="/site/moleculer-repl.html" class="sidebar-link">Moleculer REPL</a></li><li><a href="/site/mongo-client.html" class="sidebar-link">MongoDB client</a></li><li><a href="/site/http-client.html" class="active sidebar-link">HTTP client</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/http-client.html#about-the-async-http-client" class="sidebar-link">About the Async HTTP Client</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#download" class="sidebar-link">Download</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#examples" class="sidebar-link">Examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/http-client.html#blocking-usage" class="sidebar-link">Blocking usage</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#invoking-a-rest-service" class="sidebar-link">Invoking a REST service</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#invoking-with-custom-parameters" class="sidebar-link">Invoking with custom parameters</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#receiving-websocket-messages" class="sidebar-link">Receiving WebSocket messages</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#websocket-connection-events" class="sidebar-link">WebSocket connection events</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#redirecting-response" class="sidebar-link">Redirecting response</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#receiving-raw-response" class="sidebar-link">Receiving &quot;raw&quot; response</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#status-code-and-headers" class="sidebar-link">Status code and headers</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#upload-a-file" class="sidebar-link">Upload a file</a></li><li class="sidebar-sub-header"><a href="/site/http-client.html#streaming-with-packetstreams" class="sidebar-link">Streaming with PacketStreams</a></li></ul></li></ul></li><li><a href="/site/jmx-service.html" class="sidebar-link">JMX Service</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="about-the-async-http-client"><a href="#about-the-async-http-client" class="header-anchor">#</a> About the Async HTTP Client</h2> <p>The &quot;moleculer-java-httpclient&quot; is an asynchronous HTTP client API,
specially designed for Java-based Moleculer Ecosystem.
The client is suitable for handling large numbers of REST requests,
and it can receive WebSocket messages from a Netty/J2EE-based Moleculer application.
The built-in Heartbeat function automatically checks if a connection has been lost.
If a connection is lost, the client automatically rebuilds the connection.</p> <h2 id="download"><a href="#download" class="header-anchor">#</a> Download</h2> <p><strong>Maven</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.berkesa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>moleculer-java-httpclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Gradle</strong></p> <div class="language-gradle extra-class"><pre class="language-text"><code>dependencies {
	implementation group: 'com.github.berkesa', name: 'moleculer-java-httpclient', version: '1.0.0' 
}
</code></pre></div><h2 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h2> <h3 id="blocking-usage"><a href="#blocking-usage" class="header-anchor">#</a> Blocking usage</h3> <p>Blocking is not recommended, but you can use the &quot;waitFor&quot; method to wait for the server response if necessary.
The <a href="https://berkesa.github.io/datatree/introduction.html" target="_blank" rel="noopener noreferrer">Tree<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> object is practically a JSON structure.
Its contents can be retrieved using &quot;get&quot; function calls, as in a &quot;Map&quot; object.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Tree</span> rsp <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://host/rest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="invoking-a-rest-service"><a href="#invoking-a-rest-service" class="header-anchor">#</a> Invoking a REST service</h3> <p>In the example below, we call a REST service that provides a JSON response to a JSON request.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Create HTTP client (connection pool and timeout handler)</span>
<span class="token class-name">HttpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Build JSON request</span>
<span class="token class-name">Tree</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;key3&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;http://host/path&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Success (process JSON response)</span>
    <span class="token class-name">String</span> value4 <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;defaultValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catchError</span><span class="token punctuation">(</span>err <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Failed</span>
    err<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="invoking-with-custom-parameters"><a href="#invoking-with-custom-parameters" class="header-anchor">#</a> Invoking with custom parameters</h3> <div class="language-java extra-class"><pre class="language-java"><code>client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://host/rest&quot;</span><span class="token punctuation">,</span> params <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
	
    <span class="token comment">// Set parameters of the request</span>
    params<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;HttpHeader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    params<span class="token punctuation">.</span><span class="token function">setCharset</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>ISO_8859_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Parsing response (&quot;rsp&quot; is a &quot;Tree&quot; object)</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rsp<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;defaultValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="receiving-websocket-messages"><a href="#receiving-websocket-messages" class="header-anchor">#</a> Receiving WebSocket messages</h3> <p>In the following case, the client connects to the server immediately.
The heartbeat timer checks the connection every minute.</p> <div class="language-java extra-class"><pre class="language-java"><code>client<span class="token punctuation">.</span><span class="token function">ws</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000/ws/jmx&quot;</span><span class="token punctuation">,</span> payload <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// Message received!</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;RECEIVED: &quot;</span> <span class="token operator">+</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="websocket-connection-events"><a href="#websocket-connection-events" class="header-anchor">#</a> WebSocket connection events</h3> <p>In the example below, you can create your own event listeners
for the WebSocket connection and also specify connection parameters.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">WebSocketConnection</span> ws <span class="token operator">=</span>
    client<span class="token punctuation">.</span><span class="token function">ws</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000/ws/jmx&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token class-name">WebSocket</span> webSocket<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// WebSocket connection opened</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Tree</span> payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// Receiving message</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;RECEIVED:\r\n&quot;</span> <span class="token operator">+</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>				
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// Error occured</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClose</span><span class="token punctuation">(</span><span class="token class-name">WebSocket</span> webSocket<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// WebSocket connection closed</span>
    <span class="token punctuation">}</span>
			
<span class="token punctuation">}</span><span class="token punctuation">,</span> params <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			
    <span class="token comment">// Set connection parameters</span>
    params<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;HttpHeaderName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    params<span class="token punctuation">.</span><span class="token function">setHeartbeatInterval</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 mins</span>
			
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
<span class="token comment">// Connect to server</span>
ws<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
<span class="token comment">// Close connection</span>
ws<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="redirecting-response"><a href="#redirecting-response" class="header-anchor">#</a> Redirecting response</h3> <p>The 'transferTo' method is used to redirect the response to an OutputStream, WritableByteChannel or PacketStream.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Create OutputStream</span>
<span class="token class-name">FileOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;/target.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://host/path&quot;</span><span class="token punctuation">,</span> params <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			
    <span class="token comment">// Redirect response into OutputStream</span>
    params<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			
    <span class="token comment">// Transfer finished</span>
			
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="receiving-raw-response"><a href="#receiving-raw-response" class="header-anchor">#</a> Receiving &quot;raw&quot; response</h3> <p>As a result of the &quot;returnAsByteArray&quot; method, the client API will not attempt
to process the response as JSON, but will return it in raw byte-array format.</p> <div class="language-java extra-class"><pre class="language-java"><code>client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://host/path&quot;</span><span class="token punctuation">,</span> params <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			
    <span class="token comment">// Do not parse the response</span>
    params<span class="token punctuation">.</span><span class="token function">returnAsByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			
    <span class="token comment">// Get response body</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">asBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="status-code-and-headers"><a href="#status-code-and-headers" class="header-anchor">#</a> Status code and headers</h3> <p>The &quot;returnStatusCode&quot; and &quot;returnHttpHeaders&quot; methods cause the client API to copy
the status code and http headers into the &quot;meta&quot; block of the response Tree.</p> <div class="language-java extra-class"><pre class="language-java"><code>client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://host/path&quot;</span><span class="token punctuation">,</span> params <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			
    <span class="token comment">// Instructs the client to copy the values</span>
    <span class="token comment">// into the &quot;meta&quot; block</span>
    params<span class="token punctuation">.</span><span class="token function">returnStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    params<span class="token punctuation">.</span><span class="token function">returnHttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			
    <span class="token comment">// Get status code</span>
    <span class="token class-name">Tree</span> meta <span class="token operator">=</span> rsp<span class="token punctuation">.</span><span class="token function">getMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> status <span class="token operator">=</span> meta<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;$status&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
    <span class="token comment">// Get headers</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Tree</span> header<span class="token operator">:</span> meta<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;$headers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> headerName <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> headerValue <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
			
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="upload-a-file"><a href="#upload-a-file" class="header-anchor">#</a> Upload a file</h3> <p>The &quot;setBody&quot; method is used to send files or Stream content to the server.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Source file to upload</span>
<span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;/source.bin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;http://host/path&quot;</span><span class="token punctuation">,</span> params <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			
    <span class="token comment">// Set body</span>
    params<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
			
    <span class="token comment">// File uploaded</span>
			
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="streaming-with-packetstreams"><a href="#streaming-with-packetstreams" class="header-anchor">#</a> Streaming with PacketStreams</h3> <p>PacketStreams provide low-level push-to-data delivery.
It allows you to redirect responses of other Moleculer Actions directly to the HTTP request stream
(or you can open an online media stream to the server for live microphone audio recording, etc.).</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// The &quot;broker&quot; is a Moleculer Service Broker</span>
<span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
broker<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create PacketStream</span>
<span class="token class-name">PacketStream</span> stream <span class="token operator">=</span> broker<span class="token punctuation">.</span><span class="token function">createStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
<span class="token comment">// Start sending...</span>
client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;http://host/path&quot;</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
stream<span class="token punctuation">.</span><span class="token function">sendData</span><span class="token punctuation">(</span><span class="token string">&quot;packet1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
stream<span class="token punctuation">.</span><span class="token function">sendData</span><span class="token punctuation">(</span><span class="token string">&quot;packet2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
stream<span class="token punctuation">.</span><span class="token function">sendData</span><span class="token punctuation">(</span><span class="token string">&quot;packet3&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
stream<span class="token punctuation">.</span><span class="token function">sendClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/moleculer-java/site/edit/master/src/http-client.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/17/2020, 9:19:54 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/site/mongo-client.html" class="prev">MongoDB client</a></span> <span class="next"><a href="/site/jmx-service.html">JMX Service</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/site/assets/js/app.175d518a.js" defer></script><script src="/site/assets/js/2.b39afa1e.js" defer></script><script src="/site/assets/js/13.3a579dc3.js" defer></script>
  </body>
</html>
