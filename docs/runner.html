<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Moleculer Runner | Moleculer</title>
    <meta name="description" content="Progressive microservices framework for Java">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/site/assets/css/styles.styles.2cca7e80.css" as="style"><link rel="preload" href="/site/assets/js/app.08994197.js" as="script"><link rel="preload" href="/site/assets/js/0.def6c40f.js" as="script"><link rel="preload" href="/site/assets/js/17.44dac930.js" as="script"><link rel="prefetch" href="/site/assets/js/1.067dc35c.js"><link rel="prefetch" href="/site/assets/js/10.722d4bad.js"><link rel="prefetch" href="/site/assets/js/11.ebccdda1.js"><link rel="prefetch" href="/site/assets/js/12.0f62ff4b.js"><link rel="prefetch" href="/site/assets/js/13.ac82f6a9.js"><link rel="prefetch" href="/site/assets/js/14.e7df9172.js"><link rel="prefetch" href="/site/assets/js/15.a673a152.js"><link rel="prefetch" href="/site/assets/js/16.b3da87a7.js"><link rel="prefetch" href="/site/assets/js/18.55b946d2.js"><link rel="prefetch" href="/site/assets/js/19.2e1c0a41.js"><link rel="prefetch" href="/site/assets/js/2.c06d3f01.js"><link rel="prefetch" href="/site/assets/js/20.f9d34920.js"><link rel="prefetch" href="/site/assets/js/21.0a650278.js"><link rel="prefetch" href="/site/assets/js/3.20634d14.js"><link rel="prefetch" href="/site/assets/js/4.225e0db3.js"><link rel="prefetch" href="/site/assets/js/5.06df59e7.js"><link rel="prefetch" href="/site/assets/js/6.3bd8c312.js"><link rel="prefetch" href="/site/assets/js/7.5431fa0d.js"><link rel="prefetch" href="/site/assets/js/8.2c0e855f.js"><link rel="prefetch" href="/site/assets/js/9.9f233025.js">
    <link rel="stylesheet" href="/site/assets/css/styles.styles.2cca7e80.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/site/" class="home-link router-link-active"><img src="logo.png" alt="Moleculer" class="logo"> <span class="site-name can-hide">Moleculer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Core</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Clustering</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/site/transporters.html" class="sidebar-link">Transporters</a></li><li><a href="/site/serializers.html" class="sidebar-link">Serializers</a></li><li><a href="/site/balancing.html" class="sidebar-link">Load Balancing</a></li><li><a href="/site/fault-tolerance.html" class="sidebar-link">Fault Tolerance</a></li><li><a href="/site/logging.html" class="sidebar-link">Logging</a></li><li><a href="/site/runner.html" class="active sidebar-link">Runner</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/runner.html#syntax" class="sidebar-link">Syntax</a></li><li class="sidebar-sub-header"><a href="/site/runner.html#options" class="sidebar-link">Options</a></li><li class="sidebar-sub-header"><a href="/site/runner.html#configuration-loading-logic" class="sidebar-link">Configuration loading logic</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/runner.html#configuration-file" class="sidebar-link">Configuration file</a></li><li class="sidebar-sub-header"><a href="/site/runner.html#environment-variables" class="sidebar-link">Environment variables</a></li></ul></li><li class="sidebar-sub-header"><a href="/site/runner.html#services-loading-logic" class="sidebar-link">Services loading logic</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/runner.html#glob-patterns" class="sidebar-link">Glob patterns</a></li></ul></li><li class="sidebar-sub-header"><a href="/site/runner.html#built-in-clustering" class="sidebar-link">Built-in clustering</a></li><li class="sidebar-sub-header"><a href="/site/runner.html#env-files" class="sidebar-link">.env files</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Modules</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Moleculer Runner is a helper script that helps you running Moleculer projects. With it you don't need to create a ServiceBroker instance with options. Instead you can create a <code>moleculer.config.js</code> or <code>moleculer.config.json</code> file in the root of repo with broker options. Then simply call the <code>moleculer-runner</code> in NPM script and it will automatically load the configuration file, create the broker and load the services. Alternatively, you can declare your configuration as environment variables.</p> <p>{% note info Production-ready %}
In production, we recommend putting options into the environment variables! Use the <code>moleculer.config.js</code> only during development or store only common options.
:::</p> <h2 id="syntax"><a href="#syntax" class="header-anchor">#</a> Syntax</h2> <div class="language- extra-class"><pre class="language-text"><code>$ moleculer-runner [options] [service files or directories or glob masks]
</code></pre></div><blockquote><p>Note: It runs in this format in NPM scripts only. To call it directly from your console, use the <code>./node_modules/.bin/moleculer-runner --repl</code> or <code>node ./node_modules/moleculer/bin/moleculer-runner.js --repl</code> format.</p></blockquote> <h2 id="options"><a href="#options" class="header-anchor">#</a> Options</h2> <table><thead><tr><th>Option</th> <th>Type</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td><code>-r</code>, <code>--repl</code></td> <td><code>Boolean</code></td> <td><code>false</code></td> <td>If true, it switches to <a href="/site/moleculer-repl.html">REPL</a> mode after broker started.</td></tr> <tr><td><code>-s</code>, <code>--silent</code></td> <td><code>Boolean</code></td> <td><code>false</code></td> <td>Disable the broker logger. It prints nothing to the console.</td></tr> <tr><td><code>-H</code>, <code>--hot</code></td> <td><code>Boolean</code></td> <td><code>false</code></td> <td>Hot reload services when they change.</td></tr> <tr><td><code>-c</code>, <code>--config &lt;file&gt;</code></td> <td><code>String</code></td> <td><code>null</code></td> <td>Load configuration file from a different path or a different filename.</td></tr> <tr><td><code>-e</code>, <code>--env</code></td> <td><code>Boolean</code></td> <td><code>false</code></td> <td>Load envorinment variables from the '.env' file from the current folder.</td></tr> <tr><td><code>-E</code>, <code>--envfile &lt;file&gt;</code></td> <td><code>String</code></td> <td><code>null</code></td> <td>Load envorinment variables from the specified file.</td></tr> <tr><td><code>-i</code>, <code>--instances</code></td> <td><code>Number</code></td> <td><code>null</code></td> <td>Launch [number] node instances (with <code>cluster</code> module)</td></tr></tbody></table> <p><strong>Example NPM scripts</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;moleculer-runner --repl --hot --config moleculer.dev.config.js services&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;moleculer-runner --instances=4 services&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>dev</code> script loads development configurations from the <code>moleculer.dev.config.js</code> file, start all services from the <code>services</code> folder, enable hot-reloading and switches to REPL mode. Run it with the <code>npm run dev</code> command.</p> <p>The <code>start</code> script is to load the default <code>moleculer.config.js</code> file if it exists, otherwise only loads options from environment variables. Starts 4 instances of broker, then they start all services from the <code>services</code> folder. Run it with <code>npm start</code> command.</p> <h2 id="configuration-loading-logic"><a href="#configuration-loading-logic" class="header-anchor">#</a> Configuration loading logic</h2> <p>The runner does the following steps to load &amp; merge configurations:</p> <ol><li>It loads config file defined in CLI options. If it does not exist, it throws an error.</li> <li>If not defined, it loads the <code>moleculer.config.js</code> file from the current directory. If it does not exist, it loads the <code>moleculer.config.json</code> file.</li> <li>Once a config file has been loaded, it merges options with the default options of the ServiceBroker.</li> <li>The runner observes the options step by step and tries to overwrite them from environment variables. Once <code>logLevel: &quot;warn&quot;</code> is set in the config file, but the <code>LOGLEVEL=debug</code> environment variable is defined, the runner overwrites it, and it results: <code>logLevel: &quot;debug&quot;</code>.</li></ol> <blockquote><p>To overwrite broker's deeply nested default options, which are not present in <code>moleculer.config.js</code>, via environment variables, use the <code>MOL_</code> prefix and double underscore <code>__</code> for nested properties in <code>.env</code> file. For example, to set the <a href="/site/caching.html#Built-in-cachers">cacher prefix</a> to <code>MOL</code> you should declare as <code>MOL_CACHER__OPTIONS__PREFIX=MOL</code>.</p></blockquote> <h3 id="configuration-file"><a href="#configuration-file" class="header-anchor">#</a> Configuration file</h3> <p>The structure of the configuration file is the same as that of the <a href="/site/broker.html#Broker-options">broker options</a>. Every property has the same name.</p> <p><strong>Example config file</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">module</span><span class="token punctuation">.</span><span class="token keyword">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    nodeID<span class="token operator">:</span> <span class="token string">&quot;node-test&quot;</span><span class="token punctuation">,</span>
    logger<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    logLevel<span class="token operator">:</span> <span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span>

    transporter<span class="token operator">:</span> <span class="token string">&quot;nats://localhost:4222&quot;</span><span class="token punctuation">,</span>
    requestTimeout<span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>

    circuitBreaker<span class="token operator">:</span> <span class="token punctuation">{</span>
        enabled<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    metrics<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="environment-variables"><a href="#environment-variables" class="header-anchor">#</a> Environment variables</h3> <p>The runner transforms the property names to uppercase. If nested, the runner concatenates names with <code>_</code>.</p> <p><strong>Example environment variables</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">NODEID</span><span class="token operator">=</span>node-test
<span class="token assign-left variable">LOGGER</span><span class="token operator">=</span>true
<span class="token assign-left variable">LOGLEVEL</span><span class="token operator">=</span>debug

<span class="token comment"># Shorthand transporter</span>
<span class="token assign-left variable">TRANSPORTER</span><span class="token operator">=</span>nats://localhost:4222
<span class="token assign-left variable">REQUESTTIMEOUT</span><span class="token operator">=</span><span class="token number">5000</span>

<span class="token comment"># Nested property</span>
<span class="token assign-left variable">CIRCUITBREAKER_ENABLED</span><span class="token operator">=</span>true

<span class="token assign-left variable">METRICS</span><span class="token operator">=</span>true
</code></pre></div><h2 id="services-loading-logic"><a href="#services-loading-logic" class="header-anchor">#</a> Services loading logic</h2> <p>The runner loads service files or folders defined in CLI arguments. If you define folder(s), the runner loads all services <code>**/*.service.js</code> from specified one(s) (including sub-folders too). Services &amp; service folder can be loaded with <code>SERVICES</code> and <code>SERVICEDIR</code> environment variables.</p> <p><strong>Loading steps:</strong></p> <ol><li>If <code>SERVICEDIR</code> env found, but no <code>SERVICES</code> env, it loads all services from the <code>SERVICEDIR</code> directory.</li> <li>If <code>SERVICEDIR</code> &amp; <code>SERVICES</code> env found, it loads the specified services from the <code>SERVICEDIR</code> directory.</li> <li>If no <code>SERVICEDIR</code>, but <code>SERVICES</code> env found, it loads the specified services from the current directory.</li> <li>Check the CLI arguments. If filename found, it loads them. If directory found, it loads them. It glob pattern found, it applies and load the found files.</li></ol> <blockquote><p>Please note: shorthand names can also be used in <code>SERVICES</code> env var.</p></blockquote> <p><strong>Example</strong></p> <div class="language- extra-class"><pre class="language-text"><code>SERVICEDIR=services
SERVICES=math,post,user
</code></pre></div><p>It loads the <code>math.service.js</code>, <code>post.service.js</code> and <code>user.service.js</code> files from the <code>services</code> folder.</p> <div class="language- extra-class"><pre class="language-text"><code>SERVICEDIR=my-services
</code></pre></div><p>It loads all <code>*.service.js</code> files from the <code>my-services</code> folder (including sub-folders too).</p> <h3 id="glob-patterns"><a href="#glob-patterns" class="header-anchor">#</a> Glob patterns</h3> <p>If you want to be more specific, use glob patterns. It is useful when loading all services except certain ones.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ moleculer-runner services <span class="token operator">!</span>services/others/**/*.service.js services/others/mandatory/main.service.js
</code></pre></div><p><strong>Explanations:</strong></p> <ul><li><code>services</code> - legacy mode. Load all services from the <code>services</code> folder with <code>**/*.service.js</code> file mask.</li> <li><code>!services/others/**/*.service.js</code> - skip all services in the <code>services/others</code> folder and sub-folders.</li> <li><code>services/others/mandatory/main.service.js</code> - load the exact service.</li></ul> <blockquote><p>The glob patterns work in the <code>SERVICES</code> enviroment variables, as well.</p></blockquote> <h2 id="built-in-clustering"><a href="#built-in-clustering" class="header-anchor">#</a> Built-in clustering</h2> <p>Moleculer Runner has a built-in clustering function to start multiple instances from your broker.</p> <p>Example to start all services from the <code>services</code> folder in 4 instances.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ moleculer-runner --instances <span class="token number">4</span> services
</code></pre></div><p>{% note info Clustered Node ID %}
The <code>nodeID</code> will be suffixed with the worker ID. E.g. if you define <code>my-node</code> nodeID in options, and starts 4 instances, the instance nodeIDs will be <code>my-node-1</code>, <code>my-node-2</code>, <code>my-node-3</code>, <code>my-node-4</code>.
:::</p> <h2 id="env-files"><a href="#env-files" class="header-anchor">#</a> .env files</h2> <p>Moleculer runner can load <code>.env</code> file at starting. There are two new cli options to load env file:</p> <ul><li><code>-e, --env</code> - Load envorinment variables from the '.env' file from the current folder.</li> <li><code>-E, --envfile &lt;filename&gt;</code> - Load envorinment variables from the specified file.</li></ul> <p><strong>Example</strong></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Load the default .env file from current directory</span>
$ moleculer-runner --env

<span class="token comment"># Load the specified .my-env file</span>
$ moleculer-runner --envfile .my-env
</code></pre></div><p>{% note info Dependencies %}
To use this feature install the <code>dotenv</code> module with <code>npm install dotenv --save</code> command.
:::</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/site/logging.html" class="prev">Logging</a></span> <span class="next"><a href="/site/moleculer-web.html">API Gateway</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/site/assets/js/app.08994197.js" defer></script><script src="/site/assets/js/0.def6c40f.js" defer></script><script src="/site/assets/js/17.44dac930.js" defer></script>
  </body>
</html>
