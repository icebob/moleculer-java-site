<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Caching Action calls | Moleculer</title>
    <meta name="description" content="Progressive microservices framework for Java">
    <link rel="icon" href="favicon.ico">
    
    <link rel="preload" href="/site/assets/css/0.styles.75e38820.css" as="style"><link rel="preload" href="/site/assets/js/app.912cc83f.js" as="script"><link rel="preload" href="/site/assets/js/2.3acd50df.js" as="script"><link rel="preload" href="/site/assets/js/8.cb48d30a.js" as="script"><link rel="prefetch" href="/site/assets/js/10.2cecf0ec.js"><link rel="prefetch" href="/site/assets/js/11.9545b573.js"><link rel="prefetch" href="/site/assets/js/12.987d4d97.js"><link rel="prefetch" href="/site/assets/js/13.4e71680b.js"><link rel="prefetch" href="/site/assets/js/14.345413ff.js"><link rel="prefetch" href="/site/assets/js/15.dbf77abe.js"><link rel="prefetch" href="/site/assets/js/16.ddcde6dd.js"><link rel="prefetch" href="/site/assets/js/17.44709cf9.js"><link rel="prefetch" href="/site/assets/js/18.2872dc24.js"><link rel="prefetch" href="/site/assets/js/19.75e959ef.js"><link rel="prefetch" href="/site/assets/js/20.eb4d58da.js"><link rel="prefetch" href="/site/assets/js/21.6b73e890.js"><link rel="prefetch" href="/site/assets/js/22.1326cf10.js"><link rel="prefetch" href="/site/assets/js/23.5048399f.js"><link rel="prefetch" href="/site/assets/js/3.1e1471b4.js"><link rel="prefetch" href="/site/assets/js/4.97a990f8.js"><link rel="prefetch" href="/site/assets/js/5.ca18e311.js"><link rel="prefetch" href="/site/assets/js/6.0b93d9b3.js"><link rel="prefetch" href="/site/assets/js/7.6587d446.js"><link rel="prefetch" href="/site/assets/js/9.24317cce.js">
    <link rel="stylesheet" href="/site/assets/css/0.styles.75e38820.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/site/" class="home-link router-link-active"><img src="logo.png" alt="Moleculer" class="logo"> <span class="site-name can-hide">Moleculer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div> <a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/site/broker.html" class="sidebar-link">Service Broker</a></li><li><a href="/site/services.html" class="sidebar-link">Services</a></li><li><a href="/site/lifecycle.html" class="sidebar-link">Lifecycle</a></li><li><a href="/site/actions.html" class="sidebar-link">Actions</a></li><li><a href="/site/middlewares.html" class="sidebar-link">Middlewares</a></li><li><a href="/site/caching.html" class="active sidebar-link">Caching</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/caching.html#caching-action-calls" class="sidebar-link">Caching Action calls</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/caching.html#cache-keys" class="sidebar-link">Cache keys</a></li><li class="sidebar-sub-header"><a href="/site/caching.html#limiting-cache-key-length" class="sidebar-link">Limiting cache key length</a></li><li class="sidebar-sub-header"><a href="/site/caching.html#time-to-live" class="sidebar-link">Time to Live</a></li><li class="sidebar-sub-header"><a href="/site/caching.html#manual-caching" class="sidebar-link">Manual caching</a></li><li class="sidebar-sub-header"><a href="/site/caching.html#using-local-caches-in-clustered-environment" class="sidebar-link">Using local caches in clustered environment</a></li></ul></li><li class="sidebar-sub-header"><a href="/site/caching.html#local-cachers" class="sidebar-link">Local cachers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/caching.html#memory-cacher" class="sidebar-link">Memory cacher</a></li><li class="sidebar-sub-header"><a href="/site/caching.html#off-heap-memory-cacher" class="sidebar-link">Off-heap memory cacher</a></li></ul></li><li class="sidebar-sub-header"><a href="/site/caching.html#distributed-cachers" class="sidebar-link">Distributed cachers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/caching.html#redis-cacher" class="sidebar-link">Redis cacher</a></li><li class="sidebar-sub-header"><a href="/site/caching.html#jcache-cacher" class="sidebar-link">JCache cacher</a></li></ul></li><li class="sidebar-sub-header"><a href="/site/caching.html#custom-cacher" class="sidebar-link">Custom cacher</a></li></ul></li><li><a href="/site/events.html" class="sidebar-link">Events</a></li><li><a href="/site/internal-services.html" class="sidebar-link">Internal Services</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Clustering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Modules</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="caching-action-calls"><a href="#caching-action-calls" class="header-anchor">#</a> Caching Action calls</h2> <p>Moleculer has a built-in caching solution to accelerate responses of service actions.
There are two types of caches:</p> <ul><li>Local cache (eg. MemoryCacher, Off-Heap Cacher, some JCache implementations)</li> <li>Distributed cache (eg. Redis Cacher, some implementations of JCache are distributed)</li></ul> <p>Local caches store data per node locally.
These are the fastest caches, but the programmer
<a href="#using-local-caches-in-clustered-environment">must implement</a>
the delete operations on multiple nodes.
Distributed caches store data on one (or more) central cache server(s).
Distributed caches are easier to use, but they are a bit slower due to network traffic.</p> <p><strong>Cached action example</strong></p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token annotation punctuation">@Name</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

    <span class="token comment">// Enable caching for this Action</span>
    <span class="token annotation punctuation">@Cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Action</span> list <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Handler called!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token comment">// Response structure:</span>
        <span class="token comment">// [</span>
        <span class="token comment">//   { id: 1, name: &quot;John&quot; },</span>
        <span class="token comment">//   { id: 2, name: &quot;Jane&quot; }</span>
        <span class="token comment">// ]</span>
        <span class="token class-name">Tree</span> root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Tree</span> list <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">putList</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">addMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">addMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Jane&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Invoke &quot;users.list&quot; action twice:</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        
        <span class="token comment">// The first time the cache is empty, the Service will be invoked.</span>
        <span class="token keyword">return</span> broker<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;users.list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    
        <span class="token comment">// First result</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Users count:&quot;</span> <span class="token operator">+</span> rsp<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        
        <span class="token comment">// Returns from cache, handler won't be invoked.</span>
        <span class="token keyword">return</span> broker<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;users.list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

        <span class="token comment">// Second result</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Users count from cache:&quot;</span> <span class="token operator">+</span> rsp<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Console messages:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>[2017-08-18T13:04:33.845Z] INFO  Broker started.
[2017-08-18T13:04:33.848Z] INFO  Handler called!
[2017-08-18T13:04:33.849Z] INFO  Users count: 2
[2017-08-18T13:04:33.849Z] INFO  Users count from cache: 2
</code></pre></div><p>The <code>Handler called</code> message appears only once because the response of the second call came from the cache.</p> <h3 id="cache-keys"><a href="#cache-keys" class="header-anchor">#</a> Cache keys</h3> <p>The cacher generates key from service name, action name and the params of context.
The syntax of key is:</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;serviceName&gt;.&lt;actionName&gt;:&lt;parameters or hash of parameters&gt;
</code></pre></div><p>So if you call the <code>posts.list</code> action with params <code>{ limit: 5, offset: 20 }</code>,
cacher generates cache key from <code>params</code> based on JSON serialization and/or hash algorithm.
So the next time, when you call this action with the same params,
it will find the entry in the cache by key.</p> <p><strong>Example hashed cache key for &quot;posts.find&quot; action</strong></p> <div class="language- extra-class"><pre class="language-text"><code>posts.find:limit|5|offset|20
</code></pre></div><p>The <code>params</code> structure may contain properties that are not relevant to the cache key.
In addition, it can cause performance problems if the key is too long.
Therefore, we recommend that you set the key properties of the &quot;cache&quot; note, which contains a list of basic parameter names under the &quot;keys&quot; property.</p> <p>Therefore it is recommended to set the key properties of the <code>cache</code> annotation which
contains a list of essential parameter names:</p> <p><strong>Strict the list of <code>params</code> &amp; <code>meta</code> properties for key generation</strong></p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token annotation punctuation">@Name</span><span class="token punctuation">(</span><span class="token string">&quot;posts&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

    <span class="token comment">// Generate cache key from &quot;limit&quot;, &quot;offset&quot; params and &quot;user.id&quot; meta</span>
    <span class="token comment">// To use meta keys in cache &quot;keys&quot;&quot; use the &quot;#&quot; prefix.    </span>
    <span class="token annotation punctuation">@Cache</span><span class="token punctuation">(</span>keys <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;limit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;offset&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;#user.id&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Action</span> list <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Handler called!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If params is { limit: 10, offset: 30 } and meta is { user: { id: 123 } }, the cache key will be:</p> <div class="language- extra-class"><pre class="language-text"><code>posts.list:10|30|123
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Performance</p> <p>Using &quot;Cache keys&quot; can greatly speed up the application by reducing the amount of data to be serialized.<br> <img src="https://img.shields.io/badge/performance-%2B20%25-brightgreen.svg" alt=""></p></div> <h3 id="limiting-cache-key-length"><a href="#limiting-cache-key-length" class="header-anchor">#</a> Limiting cache key length</h3> <p>Occasionally, the key can be very long, which can cause performance issues.
To avoid it, maximize the length of concatenated params in the key with <code>maxParamsLength</code> cacher option.
When the key is longer than this configured limitvalue,
the cacher calculates a hash (SHA256) from the full key and adds it to the end of the key.</p> <blockquote><p>The minimum of <code>maxParamsLength</code> is 44 (SHA 256 hash length in Base64).<br>
To disable key shortening, set <code>maxParamsLength</code> to zero.</p></blockquote> <p><strong>Generate a full key from the whole params without limit</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// The params is { id: 2,</span>
<span class="token comment">//                 title: &quot;New post&quot;,</span>
<span class="token comment">//                 content: &quot;It can be very very looooooooooooooooooong content.</span>
<span class="token comment">//                           So this key will also be too long&quot;</span>
<span class="token comment">//               }</span>
cacher<span class="token punctuation">.</span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token string">&quot;posts.find&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Key: 'posts.find:id|2|title|New post|content|It can be very very looooooooooooooooooong content.</span>
<span class="token comment">//       So this key will also be too long'</span>
</code></pre></div><p><strong>Generate a limited-length key</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RedisCacher</span> cacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacher</span><span class="token punctuation">(</span><span class="token string">&quot;redis://localhost/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">setMaxParamsLength</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cacher</span><span class="token punctuation">(</span>cacher<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The params is { id: 2,</span>
<span class="token comment">//                 title: &quot;New post&quot;,</span>
<span class="token comment">//                 content: &quot;It can be very very looooooooooooooooooong content.</span>
<span class="token comment">//                           So this key will also be too long&quot;</span>
<span class="token comment">//               }</span>
cacher<span class="token punctuation">.</span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token string">&quot;posts.find&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Key: 'posts.find:id|2|title|New pL4ozUU24FATnNpDt1B0t1T5KP/T5/Y+JTIznKDspjT0='</span>
</code></pre></div><h3 id="time-to-live"><a href="#time-to-live" class="header-anchor">#</a> Time to Live</h3> <p>The TTL is the default time-to-live of cached entries in seconds.
TTL setting can be overriden in action definition.</p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token class-name">MemoryCacher</span> cacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemoryCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">setTtl</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cacher</span><span class="token punctuation">(</span>cacher<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

broker<span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Service</span><span class="token punctuation">(</span><span class="token string">&quot;posts&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Cache</span><span class="token punctuation">(</span>keys <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;limit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;offset&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;#user.id&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> ttl <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Action</span> list <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Handler called!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="manual-caching"><a href="#manual-caching" class="header-anchor">#</a> Manual caching</h3> <p>The cacher module can be used manually. Just call the <code>get</code>, <code>set</code>, <code>del</code> methods of the ServiceBroker's <code>Cacher</code>.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// The Cacher is in the ServiceBroker's config object</span>
<span class="token class-name">Cacher</span> cacher <span class="token operator">=</span> broker<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create data</span>
<span class="token class-name">Tree</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">putList</span><span class="token punctuation">(</span><span class="token string">&quot;array&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Save to cache</span>
cacher<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;mykey.a&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get from cache</span>
cacher<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;mykey.a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Data: &quot;</span> <span class="token operator">+</span> rsp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Remove entry from cache</span>
cacher<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">&quot;mykey.a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Remove all 'mykey' entries</span>
cacher<span class="token punctuation">.</span><span class="token function">clean</span><span class="token punctuation">(</span><span class="token string">&quot;mykey.**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Remove all entries from all cache regions</span>
cacher<span class="token punctuation">.</span><span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sometimes you have to clear the old cached entries
(for example, when you change the records in a database).
Example to clean the cache inside actions:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Clear all entries</span>
cacher<span class="token punctuation">.</span><span class="token function">clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Clear all entries from the `users` cache region</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>broker<span class="token punctuation">.</span>cacher<span class="token punctuation">.</span><span class="token function">clean</span><span class="token punctuation">(</span><span class="token string">&quot;users.**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Delete the specified entries</span>
cacher<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">&quot;users.list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">&quot;users.model:5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">&quot;users.model:8|true|2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="using-local-caches-in-clustered-environment"><a href="#using-local-caches-in-clustered-environment" class="header-anchor">#</a> Using local caches in clustered environment</h3> <p>The best practice to clear cache entries among multiple service instances is that use broadcast events.
This solution is only required when using local caches.
It is enough to delete shared (eg. Redis) caches with one <code>clean</code> command,
because the data is stored on a central server.
When using local caches, each node store a local copy of the cached data.</p> <p><strong>Example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Name</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserDAO</span> userDAO<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Action</span> create <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>

        <span class="token comment">// Create new user entity, so</span>
        <span class="token comment">// cached content will be obsolete</span>
        <span class="token class-name">Promise</span> res <span class="token operator">=</span> userDAO<span class="token punctuation">.</span><span class="token function">createNewUser</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Clear cache on ALL nodes</span>
        <span class="token function">cleanCacheOnAllNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Return a response</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;cache.clean.users&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Listener</span> userListener <span class="token operator">=</span> payload <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    
        <span class="token comment">// Remove all local entries from the &quot;users&quot; cache region</span>
        broker<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clean</span><span class="token punctuation">(</span><span class="token string">&quot;users.**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanCacheOnAllNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// Broadcast the event, so ALL Service instances</span>
        <span class="token comment">// receive it (including this instance). </span>
        broker<span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token string">&quot;cache.clean.users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h2 id="local-cachers"><a href="#local-cachers" class="header-anchor">#</a> Local cachers</h2> <h3 id="memory-cacher"><a href="#memory-cacher" class="header-anchor">#</a> Memory cacher</h3> <p>The <code>MemoryCacher</code> works with each node having its own local heap-based cache.
This is <strong>the fastest</strong> cache, but the programmer has to take care of emptying the cache with event broadcasting.
Memory cache is not a distributed cache, it works like a local Map in the VM's memory.
But the number of queries can be millions per second,
because repetitive queries do not generate network traffic.
Supports global and entry-level TTL.
ServiceBroker uses <code>MemoryCacher</code> by default.</p> <p><strong>Configure memory cacher</strong></p> <div class="language-java extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token class-name">MemoryCacher</span> cacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemoryCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">setAccessOrder</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true = LRU cache</span>
cacher<span class="token punctuation">.</span><span class="token function">setTtl</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// default TTL</span>
cacher<span class="token punctuation">.</span><span class="token function">setCleanup</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// period time of cleanup process</span>
cacher<span class="token punctuation">.</span><span class="token function">setCapacity</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// max cached entries per region</span>
<span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">cacher</span><span class="token punctuation">(</span>cacher<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Options</strong></p> <table><thead><tr><th>Name</th> <th>Type</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td><code>ttl</code></td> <td><code>int</code></td> <td><code>0</code></td> <td>Default time-to-live in SECONDS (0 = no TTL)</td></tr> <tr><td><code>capacity</code></td> <td><code>int</code></td> <td><code>2048</code></td> <td>Maximum number of entries per cache region</td></tr> <tr><td><code>useCloning</code></td> <td><code>boolean</code></td> <td><code>true</code></td> <td>Make clone from the returned values</td></tr> <tr><td><code>cleanup</code></td> <td><code>int</code></td> <td><code>5</code></td> <td>Cleanup period time in SECONDS</td></tr> <tr><td><code>accessOrder</code></td> <td><code>boolean</code></td> <td><code>true</code></td> <td>The ordering mode - <code>true</code> for access-order (LRU cache), <code>false</code> for insertion-order</td></tr></tbody></table> <h3 id="off-heap-memory-cacher"><a href="#off-heap-memory-cacher" class="header-anchor">#</a> Off-heap memory cacher</h3> <p>The <code>OHCacher</code> is similar to <code>MemoryCacher</code>, but stores entries in the off-heap RAM.
This cache is a bit slower than <code>MemoryCacher</code> because it stores entries in a serialized and compressed form.
<code>OHCacher</code> is the solution to store huge amount of data in memory;
if you plan to store few thousands (or less) entries in the cache,
use the faster <code>MemoryCacher</code>, otherwise use <code>OHCacher</code>.
Supports global and entry-level TTL.</p> <p><strong>Required dependency</strong></p> <p>Off-heap cacher requires <a href="https://mvnrepository.com/artifact/org.caffinitas.ohc/ohc-core-j8" target="_blank" rel="noopener noreferrer">OHC dependencies<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p><strong>Configure off-heap cacher</strong></p> <div class="language-java extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token class-name">OHCacher</span> cacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OHCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">setTtl</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">setCleanup</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">setCapacity</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">cacher</span><span class="token punctuation">(</span>cacher<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Options</strong></p> <table><thead><tr><th>Name</th> <th>Type</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td><code>ttl</code></td> <td><code>int</code></td> <td><code>0</code></td> <td>Default time-to-live in SECONDS (0 = no TTL)</td></tr> <tr><td><code>capacity</code></td> <td><code>int</code></td> <td>auto</td> <td>Capacity for data over the whole cache in MEGABYTES</td></tr> <tr><td><code>segmentCount</code></td> <td><code>int</code></td> <td><code>number-of-cores * 2</code></td> <td>Number of segments (must be a power of 2)</td></tr> <tr><td><code>hashTableSize</code></td> <td><code>int</code></td> <td><code>8192</code></td> <td>HashTable size (must be a power of 2)</td></tr> <tr><td><code>compressAbove</code></td> <td><code>int</code></td> <td><code>1024</code></td> <td>Compress key and/or value above this size (BYTES)</td></tr> <tr><td><code>compressionLevel</code></td> <td><code>int</code></td> <td><code>1</code></td> <td>Compression level (best speed = 1, best compression = 9)</td></tr></tbody></table> <h2 id="distributed-cachers"><a href="#distributed-cachers" class="header-anchor">#</a> Distributed cachers</h2> <h3 id="redis-cacher"><a href="#redis-cacher" class="header-anchor">#</a> Redis cacher</h3> <p>Redis-based distributed cache.
Supports SSL, clustering and password authentication.
It's the one of the fastest distributed cache for Moleculer.
<code>RedisCacher</code> is implemented for both Java and Node.js based Moleculer frameworks.
Supports global and entry-level TTL configuration.</p> <p><strong>Required dependency</strong></p> <p>Redis cacher requires <a href="https://mvnrepository.com/artifact/biz.paluch.redis/lettuce" target="_blank" rel="noopener noreferrer">Letuce API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p><strong>Configure Redis cacher</strong></p> <div class="language-java extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code><span class="token class-name">RedisCacher</span> cacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">setUrls</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">setTtl</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">cacher</span><span class="token punctuation">(</span>cacher<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>With MessagePack serializer</strong></p> <div class="language-java extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-java"><code><span class="token class-name">RedisCacher</span> cacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cacher<span class="token punctuation">.</span><span class="token function">setSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MsgPackSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cacher<span class="token punctuation">.</span><span class="token function">setUrls</span><span class="token punctuation">(</span><span class="token string">&quot;redis://host1:6380&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;redis://host2:6381&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">cacher</span><span class="token punctuation">(</span>cacher<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Options</strong></p> <table><thead><tr><th>Name</th> <th>Type</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td><code>urls</code></td> <td><code>String[]</code></td> <td><code>localhost</code></td> <td>Array of URLs of the Redis servers</td></tr> <tr><td><code>ttl</code></td> <td><code>int</code></td> <td><code>0</code></td> <td>Time-to-live in SECONDS (0 = disabled)</td></tr> <tr><td><code>maxParamsLength</code></td> <td><code>int</code></td> <td><code>0</code></td> <td>Maximum length of params in generated keys</td></tr> <tr><td><code>serializer</code></td> <td><code>Serializer</code></td> <td><code>JsonSerializer</code></td> <td>Implementation of the serializer/deserializer</td></tr> <tr><td><code>password</code></td> <td><code>String</code></td> <td><code>null</code></td> <td>Configures authentication (URI may contain the password)</td></tr> <tr><td><code>secure</code></td> <td><code>boolean</code></td> <td><code>false</code></td> <td>Sets SSL connection on/off (URI may contain the SSL info)</td></tr></tbody></table> <p><strong>Redis URI syntax</strong></p> <p>Redis Standalone:</p> <p><em>redis</em> : // [<em>:</em> <em>password</em>@] <em>host</em> [<em>:</em> <em>port</em>] [<em>/</em> <em>database</em>][<em>?</em> [<em>timeout=timeout</em>[<em>d|h|m|s|ms|us|ns</em>]] [&amp;<em>database=database</em>]]</p> <p>Redis Standalone with SSL:</p> <p><em>rediss</em> : // [<em>:</em> <em>password</em>@] <em>host</em> [<em>:</em> <em>port</em>] [<em>/</em> <em>database</em>][<em>?</em> [<em>timeout=timeout</em>[<em>d|h|m|s|ms|us|ns</em>]] [&amp;<em>database=database</em>]]</p> <p>Redis Standalone with Unix Domain Sockets:</p> <p><em>redis-socket</em> : // [<em>:</em> <em>password</em>@]<em>path</em> [<em>?</em>[<em>timeout=timeout</em>[<em>d|h|m|s|ms|us|ns</em>]][&amp;<em>database=database</em>]]</p> <p>Redis Sentinel:</p> <p><em>redis-sentinel</em> : // [<em>:</em> <em>password</em>@] <em>host1</em>[<em>:</em> <em>port1</em>] [, <em>host2</em>[<em>:</em> <em>port2</em>]] [, <em>hostN</em>[<em>:</em> <em>portN</em>]] [<em>/</em> <em>database</em>][<em>?</em>[<em>timeout=timeout</em>[<em>d|h|m|s|ms|us|ns</em>]] [&amp;<em>sentinelMasterId=sentinelMasterId</em>] [&amp;<em>database=database</em>]]</p> <h3 id="jcache-cacher"><a href="#jcache-cacher" class="header-anchor">#</a> JCache cacher</h3> <p>JSR-107 JCache is a standardized caching API.
Core JCache API does NOT support entry-level TTL parameter.
If you need this feature use RedisCacher, MemoryCacher, or Off-heap Cacher.
JCache is implemented by various caching solutions:</p> <ul><li>Apache Ignite</li> <li>Hazelcast</li> <li>Oracle Coherence</li> <li>Terracotta Ehcache</li> <li>Infinispan</li> <li>Blazing Cache</li> <li>Cache2k</li> <li>Caffeine</li> <li>etc.</li></ul> <p>The performance and operation of JCacher implementations can be very different.</p> <p><strong>Required dependency</strong></p> <p>JCache cacher requires <a href="https://mvnrepository.com/artifact/javax.cache/cache-api" target="_blank" rel="noopener noreferrer">JCache API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
and it is also necessary to put the dependencies of the JCache implementation in the classpath.</p> <p><strong>Configure JCache cacher</strong></p> <p>Using the JVM's default JCache implementation:</p> <div class="language-java extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br></div><pre class="language-java"><code><span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">cacher</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JCacheCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Create Cacher using the specified CacheProvider implementation:</p> <div class="language-java extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-java"><code><span class="token comment">// &quot;RICachingProvider&quot; is part of a JCache implementation,</span>
<span class="token comment">// but it can be arbitrary (eg. Hazelcast or EHcache based)</span>
<span class="token class-name">CachingProvider</span> provider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RICachingProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">CacheManager</span> manager <span class="token operator">=</span> provider<span class="token punctuation">.</span><span class="token function">getCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">JCacheCacher</span> cacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JCacheCacher</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">cacher</span><span class="token punctuation">(</span>cacher<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Options</strong></p> <table><thead><tr><th>Name</th> <th>Type</th> <th>Default</th> <th>Description</th></tr></thead> <tbody><tr><td><code>maxParamsLength</code></td> <td><code>int</code></td> <td><code>0</code></td> <td>Maximum length of params in generated keys</td></tr> <tr><td><code>closeEmptyPartitions</code></td> <td><code>boolean</code></td> <td><code>true</code></td> <td>Close and dispose empty caches</td></tr></tbody></table> <h2 id="custom-cacher"><a href="#custom-cacher" class="header-anchor">#</a> Custom cacher</h2> <p>When you create your own Cacher, the new Cacher class must be inherited from <code>services.moleculer.cacher.Cacher</code>.
The get(), set(), del(), clean() functions must be implemented.
You can get ideas for implementation from the contents of the <code>services.moleculer.cacher</code> package,
which contains the Cachers already made.
The easiest way to build your own Cacher implementation is to inherit your own from an existing cacher class.
To overwrite the built-in cache key generator,
override the <code>getCacheKey</code> function with your implementation.
The implementations of the cachers can be found in the <code>services.moleculer.cacher</code> package.</p> <div class="language-java extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br></div><pre class="language-java"><code><span class="token class-name">Cacher</span> cacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyCustomCacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ServiceBroker</span> broker <span class="token operator">=</span> <span class="token class-name">ServiceBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">cacher</span><span class="token punctuation">(</span>cacher<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/site/middlewares.html" class="prev">Middlewares</a></span> <span class="next"><a href="/site/events.html">Events</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/site/assets/js/app.912cc83f.js" defer></script><script src="/site/assets/js/2.3acd50df.js" defer></script><script src="/site/assets/js/8.cb48d30a.js" defer></script>
  </body>
</html>
