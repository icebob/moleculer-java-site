(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{10:function(t,e,a){"use strict";function s(t,e,a,s,n,r,o,c){var p,i="function"==typeof t?t.options:t;if(e&&(i.render=e,i.staticRenderFns=a,i._compiled=!0),s&&(i.functional=!0),r&&(i._scopeId="data-v-"+r),o?(p=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},i._ssrRegister=p):n&&(p=c?function(){n.call(this,this.$root.$options.shadowRoot)}:n),p)if(i.functional){i._injectStyles=p;var v=i.render;i.render=function(t,e){return p.call(e),v(t,e)}}else{var l=i.beforeCreate;i.beforeCreate=l?[].concat(l,p):[p]}return{exports:t,options:i}}a.d(e,"a",(function(){return s}))},211:function(t,e,a){"use strict";a.r(e);var s=a(10),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("ServiceBroker protects against circular function calls.\nIt also manages call-level timeout and has a retry logic handler.\nIn addition, there is a built-in Circuit Breaker solution in Moleculer.\nA Circuit Breaker does the Action calls and it monitors the service health. Once it gets some issue,\nit trips and all further calls goto another Node and finally restores automatically once the Service came back.")]),t._v(" "),a("h2",{attrs:{id:"default-service-invoker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#default-service-invoker"}},[t._v("#")]),t._v(" Default Service Invoker")]),t._v(" "),a("p",[t._v("This is the default call logic when you create a ServiceBroker instance.")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create a Default Service Invoker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DefaultServiceInvoker")]),t._v(" invoker "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DefaultServiceInvoker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Max call level to avoid circular calls")]),t._v("\ninvoker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMaxCallLevel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Write errors to log file")]),t._v("\ninvoker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setWriteErrorsToLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create Service Broker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServiceBroker")]),t._v(" broker "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServiceBroker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("invoker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"settings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#settings"}},[t._v("#")]),t._v(" Settings")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("maxCallLevel")])]),t._v(" "),a("td",[a("code",[t._v("int")])]),t._v(" "),a("td",[a("code",[t._v("100")])]),t._v(" "),a("td",[t._v("Max call level to avoid circular calls")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("writeErrorsToLog")])]),t._v(" "),a("td",[a("code",[t._v("boolean")])]),t._v(" "),a("td",[a("code",[t._v("true")])]),t._v(" "),a("td",[t._v("Write errors to log file")])])])]),t._v(" "),a("h3",{attrs:{id:"call-level-retry-and-timeout"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#call-level-retry-and-timeout"}},[t._v("#")]),t._v(" Call-level retry and timeout")]),t._v(" "),a("p",[t._v("The Default Service Invoker handles retry and timeout parameters for function calls.")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create JSON request")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tree")]),t._v(" req "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tree")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nreq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"value"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nreq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("putList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"array"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Invoke service with retry and timeout parameters")]),t._v("\nbroker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"service.action"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CallOptions")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("retryCount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rsp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Process JSON response")]),t._v("\n\t\t\t\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catchError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Error handler")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"distributed-timeouts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#distributed-timeouts"}},[t._v("#")]),t._v(" Distributed timeouts")]),t._v(" "),a("p",[t._v("Moleculer uses "),a("a",{attrs:{href:"https://www.datawire.io/guide/traffic/deadlines-distributed-timeouts-microservices/",target:"_blank",rel:"noopener noreferrer"}},[t._v("distributed timeouts"),a("OutboundLink")],1),t._v(".\nIn case of nested calls, the timeout value is decremented with the elapsed time.\nIf the timeout value is less or equal than 0, the next nested calls will be skipped ("),a("code",[t._v("RequestSkippedError")]),t._v(")\nbecause the first call has already been rejected with a "),a("code",[t._v("RequestTimeoutError")]),t._v(" error.")]),t._v(" "),a("h2",{attrs:{id:"circuit-breaker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#circuit-breaker"}},[t._v("#")]),t._v(" Circuit Breaker")]),t._v(" "),a("p",[t._v("Moleculer has a built-in circuit-breaker solution.\nIt uses a time window to check the number of the failed requests.\nOnce the error limit is reached, it trips the circuit breaker.\nThe Circuit Breaker is a descendant of Default Service Invoker.")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("What is the circuit breaker?")]),t._v(" "),a("p",[t._v("The Circuit Breaker can prevent an application from repeatedly trying to execute an operation that's likely to fail.\nAllowing it to continue without waiting for the fault to be fixed or wasting CPU cycles while it determines that the fault is long lasting.\nThe Circuit Breaker pattern also enables an application to detect whether the fault has been resolved.\nIf the problem appears to have been fixed, the application can try to invoke the operation.")]),t._v(" "),a("p",[t._v("Read more about circuit breaker on "),a("a",{attrs:{href:"https://martinfowler.com/bliki/CircuitBreaker.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Martin Fowler blog"),a("OutboundLink")],1),t._v("\nor on "),a("a",{attrs:{href:"https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker",target:"_blank",rel:"noopener noreferrer"}},[t._v("Microsoft Azure Docs"),a("OutboundLink")],1),t._v(".")])]),t._v(" "),a("p",[t._v("If you enable it, all service calls will be protected by this built-in circuit breaker.")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create Circuit Breaker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CircuitBreaker")]),t._v(" invoker "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CircuitBreaker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Max call level to avoid circular calls")]),t._v("\ninvoker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMaxCallLevel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Length of time-window in MILLISECONDS")]),t._v("\ninvoker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setWindowLength")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Maximum number of errors in time-window")]),t._v("\ninvoker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMaxErrors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Half-open timeout in MILLISECONDS")]),t._v("\ninvoker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setLockTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create Service Broker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServiceBroker")]),t._v(" broker "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServiceBroker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("invoker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"settings-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#settings-2"}},[t._v("#")]),t._v(" Settings")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("windowLength")])]),t._v(" "),a("td",[a("code",[t._v("long")])]),t._v(" "),a("td",[a("code",[t._v("5000")])]),t._v(" "),a("td",[t._v("Length of time-window in milliseconds")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("maxErrors")])]),t._v(" "),a("td",[a("code",[t._v("Number")])]),t._v(" "),a("td",[a("code",[t._v("3")])]),t._v(" "),a("td",[t._v("Maximum number of errors in time-window")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("lockTimeout")])]),t._v(" "),a("td",[a("code",[t._v("Number")])]),t._v(" "),a("td",[a("code",[t._v("10000")])]),t._v(" "),a("td",[t._v("Number of milliseconds to switch from "),a("code",[t._v("open")]),t._v(" to "),a("code",[t._v("half-open")]),t._v(" state")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("ignoredTypes")])]),t._v(" "),a("td",[a("code",[t._v("Throwable[]")])]),t._v(" "),a("td",[t._v("null")]),t._v(" "),a("td",[t._v("Ignorable Error/Exception types")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("maxCallLevel")])]),t._v(" "),a("td",[a("code",[t._v("int")])]),t._v(" "),a("td",[a("code",[t._v("100")])]),t._v(" "),a("td",[t._v("Max call level to avoid circular calls")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("writeErrorsToLog")])]),t._v(" "),a("td",[a("code",[t._v("boolean")])]),t._v(" "),a("td",[a("code",[t._v("true")])]),t._v(" "),a("td",[t._v("Write errors to log file")])])])])])}),[],!1,null,null,null);e.default=n.exports}}]);