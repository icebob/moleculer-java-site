<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Services | Moleculer</title>
    <meta name="description" content="Progressive microservices framework for Java">
    
    
    <link rel="preload" href="/site/assets/css/0.styles.75e38820.css" as="style"><link rel="preload" href="/site/assets/js/app.df664188.js" as="script"><link rel="preload" href="/site/assets/js/2.ee67e98b.js" as="script"><link rel="preload" href="/site/assets/js/25.8ed0f3cc.js" as="script"><link rel="prefetch" href="/site/assets/js/10.f3a83f7d.js"><link rel="prefetch" href="/site/assets/js/11.654947dc.js"><link rel="prefetch" href="/site/assets/js/12.93b1cce5.js"><link rel="prefetch" href="/site/assets/js/13.b2e17778.js"><link rel="prefetch" href="/site/assets/js/14.36cbf7c0.js"><link rel="prefetch" href="/site/assets/js/15.8b63eaab.js"><link rel="prefetch" href="/site/assets/js/16.fcd49c4d.js"><link rel="prefetch" href="/site/assets/js/17.0e8fd899.js"><link rel="prefetch" href="/site/assets/js/18.f54de2eb.js"><link rel="prefetch" href="/site/assets/js/19.5f350f1d.js"><link rel="prefetch" href="/site/assets/js/20.2f59ddd3.js"><link rel="prefetch" href="/site/assets/js/21.f47cd107.js"><link rel="prefetch" href="/site/assets/js/22.9497ca52.js"><link rel="prefetch" href="/site/assets/js/23.2fea0d6f.js"><link rel="prefetch" href="/site/assets/js/24.b704a915.js"><link rel="prefetch" href="/site/assets/js/26.ec4d95cd.js"><link rel="prefetch" href="/site/assets/js/27.d61b2d89.js"><link rel="prefetch" href="/site/assets/js/3.f084eaa4.js"><link rel="prefetch" href="/site/assets/js/4.a02ade56.js"><link rel="prefetch" href="/site/assets/js/5.357c372d.js"><link rel="prefetch" href="/site/assets/js/6.ce997fe8.js"><link rel="prefetch" href="/site/assets/js/7.6e125bba.js"><link rel="prefetch" href="/site/assets/js/8.67823e67.js"><link rel="prefetch" href="/site/assets/js/9.ba0591b5.js">
    <link rel="stylesheet" href="/site/assets/css/0.styles.75e38820.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/site/" class="home-link router-link-active"><!----> <span class="site-name">Moleculer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div><div class="nav-item"><a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/introduction.html" class="nav-link">Documentation</a></div><div class="nav-item"><a href="https://github.com/moleculer-java/moleculer-java" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/site/broker.html" class="sidebar-link">Service Broker</a></li><li><a href="/site/services.html" class="active sidebar-link">Services</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/services.html#actions" class="sidebar-link">Actions</a></li><li class="sidebar-sub-header"><a href="/site/services.html#services-with-different-versions" class="sidebar-link">Services with different versions</a></li><li class="sidebar-sub-header"><a href="/site/services.html#converting-java-annotations-to-platform-independent-properties" class="sidebar-link">Converting Java Annotations to platform-independent properties</a></li><li class="sidebar-sub-header"><a href="/site/services.html#events" class="sidebar-link">Events</a></li><li class="sidebar-sub-header"><a href="/site/services.html#lifecycle-handlers" class="sidebar-link">Lifecycle handlers</a></li><li class="sidebar-sub-header"><a href="/site/services.html#dependencies" class="sidebar-link">Dependencies</a></li></ul></li><li><a href="/site/lifecycle.html" class="sidebar-link">Lifecycle</a></li><li><a href="/site/actions.html" class="sidebar-link">Actions</a></li><li><a href="/site/middlewares.html" class="sidebar-link">Middlewares</a></li><li><a href="/site/caching.html" class="sidebar-link">Caching</a></li><li><a href="/site/events.html" class="sidebar-link">Events</a></li><li><a href="/site/internal-services.html" class="sidebar-link">Internal Services</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Clustering</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Modules</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>The <code>Service</code> is the top-level component in the Moleculer Ecosystem.
Services may have Actions that other Services can invoke locally or over the network.
Services can also define Event Listeners that can react to events created in the Moleculer Cluster.
Using the Moleculer Framework, Services written in different (Java,
<a href="https://moleculer.services/" target="_blank" rel="noopener noreferrer">JavaScript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> or <a href="https://moleculer-go-site.herokuapp.com/" target="_blank" rel="noopener noreferrer">Go<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)
languages can work effectively with each other.</p> <p>Moleculer can be integrated with the Spring Framework.
In the Spring Environment, Moleculer Services and ServiceBroker are Spring Beans.
This will allow Moleculer Services to access the other Spring Components.</p> <p>The <a href="/site/moleculer-web.html">WEB API Gateway</a>
module enables the Moleculer Services to function as REST/HTML services
generating HTML pages using server-side Template Engines.
In addition, they can receive / send large files or send WebSocket packets to browsers.</p> <h2 id="actions"><a href="#actions" class="header-anchor">#</a> Actions</h2> <p>The actions are the callable/public methods of a Service.
They are callable with <code>broker.call</code> or <code>ctx.call</code> methods.<br> <a href="/site/actions.html">Read more about Actions.</a></p> <p><strong>Example</strong></p> <p>A Service schema of adding and subtracting two numbers (the example defines two Actions):</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Name</span><span class="token punctuation">(</span><span class="token string">&quot;math&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

    <span class="token class-name">Action</span> add <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> 
               ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token class-name">Action</span> sub <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span>
               ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>@Name</code> attribute isn't a mandatory property, if missing,
MessageBroker will generate the Service name from the Class name.
The algorithm used to create Services names is similar to when Spring registers Beans;
the first letter will be lowercase, the rest will not change
(for example, <code>MathService</code> registers as &quot;mathService&quot;).
This rule also applies to Action names;
you can specify the name with the &quot;@Name&quot; attribute;
if missing, the Java field name will be the action name (eg. <code>add</code> Action registers as &quot;add&quot;).
To register the <code>MathService</code> in a MessageBroker, use the <code>createService</code> method:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MessageBroker</span> broker <span class="token operator">=</span> <span class="token class-name">MessageBroker</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
broker<span class="token punctuation">.</span><span class="token function">createService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MathService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
broker<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To call the Service, use the <code>call</code> method:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// in thread-blocking style:</span>

<span class="token class-name">Tree</span> rsp <span class="token operator">=</span> broker<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;math.add&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Response: &quot;</span> <span class="token operator">+</span> rsp<span class="token punctuation">.</span><span class="token function">asInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...or, in non-blocking style:</span>

broker<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;math.sub&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Response: &quot;</span> <span class="token operator">+</span> rsp<span class="token punctuation">.</span><span class="token function">asInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>From the caller perspective does not matter the physical location of the Service.
The &quot;math.add&quot; and &quot;math.sub&quot; Actions can be on other machine,
written in a different programming language.</p> <h2 id="services-with-different-versions"><a href="#services-with-different-versions" class="header-anchor">#</a> Services with different versions</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Name</span><span class="token punctuation">(</span><span class="token string">&quot;math&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Version</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathV2Service</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

    <span class="token comment">// Modified &quot;add&quot; and &quot;sub&quot; Actions...    </span>
<span class="token punctuation">}</span>
</code></pre></div><p>To call the versioned Service, use the &quot;v2.&quot; prefix:</p> <div class="language-java extra-class"><pre class="language-java"><code>broker<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;v2.math.add&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">REST call</p> <p>Via <a href="/site/moleculer-web.html">WEB API Gateway</a>, make a request to <code>GET /v2/math/add</code>.</p></div> <h2 id="converting-java-annotations-to-platform-independent-properties"><a href="#converting-java-annotations-to-platform-independent-properties" class="header-anchor">#</a> Converting Java Annotations to platform-independent properties</h2> <p>ServiceBroker converts Java Annotations of Actions into JSON format,
therefore, they can be parsed on remote nodes.
The programming language doesn't matter, such as those available on JavaScript based nodes.
These properties are passed on as the service is discovered.</p> <p>It is advisable to process these properties using (Java or JavaScipt-based)
<a href="/site/middlewares.html">Middlewares</a>, and based on the values of the properties,
Middlewares may change the way the services work.</p> <p>The following example shows three types of Annotation conversions.
The first one (the <code>@Deprecated</code>) is an Annotation without parameters.
Such Annotations are passed as logical values with a &quot;true&quot; value.
The second Annotation (the <code>@SingleValue</code>) can have only one value.
Such Annotations are passed as a key-value pair.
The third Annotation (the <code>@MultiValue</code>) contains more values.
Such Annotations are converted into a JSON structures by the ServiceBroker.
It is important to note that only Annotations with a <code>RetentionPolicy</code> value of <code>RUNTIME</code>
will be available in the Service Descriptor
(for example, <code>@SuppressWarnings</code> is not visible on remote nodes
because it exists only at the source level).</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Name</span><span class="token punctuation">(</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token annotation punctuation">@SingleValue</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@MultiValue</span><span class="token punctuation">(</span>key1<span class="token operator">:</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> key2<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">)</span>
    <span class="token class-name">Action</span> action <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>Generated service description, also available on remote nodes:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;service.action&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;service.action&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;deprecated&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;singleValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;multiValue&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;key1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;key2&quot;</span><span class="token operator">:</span> <span class="token number">123</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The Service Descriptor is received by all remote nodes and can be processed,
regardless of the programming language.
Sample Middleware that checks the configuration of a Java (or JavaScript) Action:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeprecationChecker</span> <span class="token keyword">extends</span> <span class="token class-name">Middleware</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Action</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token class-name">Action</span> action<span class="token punctuation">,</span> <span class="token class-name">Tree</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// Get value of the property (false = default value)</span>
        <span class="token keyword">boolean</span> deprecated <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;deprecated&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Print warning if the Action is deprecated </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>deprecated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; action is deprecated!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To install the above Middleware, call the ServiceBroker <code>use</code> function:</p> <div class="language-java extra-class"><pre class="language-java"><code>broker<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DeprecationChecker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="events"><a href="#events" class="header-anchor">#</a> Events</h2> <p>Services can monitor Events.
Events can come from local but also from remote nodes.
The data content of Events, like Action's, is a JSON structure.
<a href="/site/events.html">Read more about event handling.</a></p> <p><strong>Example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;order.created&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Listener</span> orderCreated <span class="token operator">=</span> ctx <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Received data:&quot;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="lifecycle-handlers"><a href="#lifecycle-handlers" class="header-anchor">#</a> Lifecycle handlers</h2> <p>There are some lifecycle service events, that will be triggered by the ServiceBroker.
These are called when ServiceBroker starts or stops the Services.<br> <a href="/site/lifecycle.html">Read more about lifecycle of Services.</a></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">started</span><span class="token punctuation">(</span><span class="token class-name">ServiceBroker</span> broker<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">started</span><span class="token punctuation">(</span>broker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Custom initialization functions</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stopped</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Closing resources, stopping timers</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span> 
</code></pre></div><p>Other system-level events can be handled by Event Listeners
(eg. another Node joining the cluster or a change in the Service list).<br> <a href="/site/events.html">Read more about internal events.</a></p> <h2 id="dependencies"><a href="#dependencies" class="header-anchor">#</a> Dependencies</h2> <p>If a Service depends on other Services, use the <code>@Dependencies</code> Annotation to denote dependencies.
The service waits for dependent services before calls the <code>started</code> lifecycle event handler.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Dependencies</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;logService&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;backendService&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The main difference between the <code>@Dependencies</code> Annotation and Spring <code>@DependsOn</code> Annotation
is that <code>@Dependencies</code> monitors the entire Moleculer Cluster.
In the example above, &quot;logService&quot; or &quot;backendService&quot; can be a <strong>remote</strong> Service.
The Spring <code>@DependsOn</code> Annotation only monitors the local <code>ApplicationContext</code>.</p> <h3 id="wait-for-services-via-servicebroker"><a href="#wait-for-services-via-servicebroker" class="header-anchor">#</a> Wait for services via ServiceBroker</h3> <p>To wait for services, you can also use the <code>waitForServices</code> method of <code>ServiceBroker</code>.
It returns a <code>Promise</code> which will be resolved when all defined services are available &amp; started.</p> <p><strong>Example</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>broker<span class="token punctuation">.</span><span class="token function">waitForServices</span><span class="token punctuation">(</span><span class="token string">&quot;posts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Called after the &quot;posts&quot; and &quot;users&quot; services are available</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Handle timeout</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>broker<span class="token punctuation">.</span><span class="token function">waitForServices</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">&quot;accounts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>rsp <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Call it when the &quot;accounts&quot; service becomes available within 10 seconds</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catchError</span><span class="token punctuation">(</span>err <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Called if the wait time is more than 10 seconds</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/site/broker.html" class="prev">Service Broker</a></span> <span class="next"><a href="/site/lifecycle.html">Lifecycle</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/site/assets/js/app.df664188.js" defer></script><script src="/site/assets/js/2.ee67e98b.js" defer></script><script src="/site/assets/js/25.8ed0f3cc.js" defer></script>
  </body>
</html>
